"use strict";
self["webpackHotUpdateroom187"]("main",{

/***/ "./app/pages/Gallery/index.js":
/*!************************************!*\
  !*** ./app/pages/Gallery/index.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Gallery)
/* harmony export */ });
/* harmony import */ var classes_Page__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! classes/Page */ "./app/classes/Page.js");
/* harmony import */ var gsap__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! gsap */ "./node_modules/gsap/index.js");
/* harmony import */ var utils_LenisScroll__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! utils/LenisScroll */ "./app/utils/LenisScroll.js");
/* harmony import */ var gsap_CustomEase__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! gsap/CustomEase */ "./node_modules/gsap/CustomEase.js");




class Gallery extends classes_Page__WEBPACK_IMPORTED_MODULE_0__["default"] {
  constructor() {
    super({
      id: 'gallery',
      elements: {
        gallery: '[data-gallery]',
        galleryItems: '[data-gallery-item]',
        slideShow: '[data-slideshow]',
        prev: '[data-slideshow-prev]',
        next: '[data-slideshow-next]',
        close: '[data-slideshow] [data-close]',
        slideShowContainer: '[data-slideshow-container]',
        miniMap: '[data-mini-map]',
        miniMapItems: '[data-mini-map-item]'
      }
    });
    gsap__WEBPACK_IMPORTED_MODULE_2__["default"].registerPlugin(gsap_CustomEase__WEBPACK_IMPORTED_MODULE_3__.CustomEase);
    gsap_CustomEase__WEBPACK_IMPORTED_MODULE_3__.CustomEase.create("zoom", "0.71, 0, 0.06, 1");
    this.tl = gsap__WEBPACK_IMPORTED_MODULE_2__["default"].timeline();
    this.currentIndex = 0;
    this.media = [];
    this.scroll = utils_LenisScroll__WEBPACK_IMPORTED_MODULE_1__.scroll;
    this.hasMediaBeenSet = false;
    this.isHovered = false;
    this.scrollSpeed = 1;
    this.duplicatedItems = [];
    this.allowSlideNavigation = false;
    this.init();
  }
  openSlideShow(e) {
    const mediaElement = e.target;
    const mediaId = mediaElement.dataset.galleryId;
    this.currentIndex = this.media.findIndex(media => media.dataset.galleryId === mediaId);
    this.scroll.stop();
    this.tl.clear();
    this.tl.to(this.elements.galleryItems, {
      clipPath: "polygon(0% 100%, 100% 100%, 100% 100%, 0% 100%)",
      duration: 0.6,
      ease: "zoom"
    });
    this.tl.to(this.elements.slideShow, {
      clipPath: "polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)",
      duration: 0.6,
      ease: "zoom",
      onComplete: () => {
        this.elements.slideShow.classList.remove('cannot-interact');
        this.showMedia();
        this.enableSlideNavigation();
      }
    });
    this.tl.to(this.elements.close, {
      opacity: 1,
      duration: 0.3,
      ease: "power2.out"
    });
    this.tl.to(this.elements.prev, {
      opacity: 1,
      duration: 0.3,
      ease: "power2.out"
    }, 'controls');
    this.tl.to(this.elements.next, {
      opacity: 1,
      duration: 0.3,
      ease: "power2.out"
    }, 'controls');
  }
  closeSlideShow() {
    this.disableSlideNavigation();
    let slideShowMedia = document.querySelector('.slideshow-media__item');
    this.elements.slideShow.classList.add('cannot-interact');
    this.tl.to(this.elements.slideShow, {
      clipPath: "polygon(0% 100%, 100% 100%, 100% 100%, 0% 100%)",
      duration: 0.6,
      ease: "zoom",
      onComplete: () => {
        slideShowMedia.remove();
        this.hasMediaBeenSet = false;
        this.scroll.start();
        this.animateImages(false, true);
      }
    });
    this.tl.to(this.elements.close, {
      opacity: 0,
      duration: 0.001
    }, 'hide');
    this.tl.to(this.elements.prev, {
      opacity: 0,
      duration: 0.001
    }, 'hide');
    this.tl.to(this.elements.next, {
      opacity: 0,
      duration: 0.001
    }, 'hide');

    // Remove image parameter from URL
    const newUrl = new URL(window.location);
    newUrl.searchParams.delete("media");
    window.history.pushState({}, "", newUrl);
  }
  changeMedia(direction) {
    const oldIndex = this.currentIndex;
    this.currentIndex = (this.currentIndex + direction + this.media.length) % this.media.length;
    if (oldIndex === this.currentIndex) return;
    if (this.tl.isActive()) {
      this.tl.add(() => {
        this.showMedia();
      });
    } else {
      this.showMedia();
    }
  }
  showMedia() {
    const mediaCurrentElem = this.media[this.currentIndex];
    const mediaType = mediaCurrentElem.dataset.galleryItem;
    const mediaId = mediaCurrentElem.dataset.galleryId;
    this.updateMinimapIndicator(mediaId);

    // If the same media, don't do anything
    if (this.elements.slideShowContainer.querySelector(`[data-slideshow-id="${mediaId}"]`)) {
      return;
    }
    if (!this.hasMediaBeenSet) {
      this.createAndSetMediaElement(mediaCurrentElem, mediaType);
      this.hasMediaBeenSet = true;
    } else {
      this.swapMediaElement(mediaCurrentElem, mediaType);
    }

    // Update the URL with the new image ID
    const newUrl = new URL(window.location);
    newUrl.searchParams.set("media", mediaId);
    window.history.pushState({}, "", newUrl);
  }
  createAndSetMediaElement(mediaElem, mediaType) {
    const newElem = this.createNewMediaItem(mediaType);
    this.setMediaAttributes(newElem, mediaElem, mediaType);
    this.elements.slideShowContainer.innerHTML = ''; // Clear previous elements
    this.elements.slideShowContainer.appendChild(newElem);
    gsap__WEBPACK_IMPORTED_MODULE_2__["default"].fromTo(newElem, {
      clipPath: "polygon(0% 100%, 100% 100%, 100% 100%, 0% 100%)"
    }, {
      clipPath: "polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)",
      duration: 0.6,
      ease: "zoom"
    });
  }
  swapMediaElement(mediaElem, mediaType) {
    const oldElem = this.elements.slideShowContainer.firstChild;
    const newElem = this.createNewMediaItem(mediaType);
    this.setMediaAttributes(newElem, mediaElem, mediaType);
    this.elements.slideShowContainer.appendChild(newElem);
    this.tl.fromTo(newElem, {
      clipPath: "polygon(0% 100%, 100% 100%, 100% 100%, 0% 100%)"
    }, {
      clipPath: "polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)",
      duration: 0.6,
      ease: "zoom"
    });
    this.tl.to(oldElem, {
      clipPath: "polygon(0% 100%, 100% 100%, 100% 100%, 0% 100%)",
      duration: 0.6,
      ease: "power2.out",
      onComplete: () => {
        oldElem.remove();
      }
    }, "-=0.2");
  }
  setupScrollNavigation() {
    let ticking = false;
    window.addEventListener('wheel', e => {
      if (!this.allowSlideNavigation || ticking) return;
      ticking = true;
      const direction = e.deltaY > 0 ? 1 : -1;
      this.changeMedia(direction);
      setTimeout(() => {
        ticking = false;
      }, 600); // delay to prevent overscroll
    });
  }
  setupSwipeNavigation() {
    let touchStartX = 0;
    let touchEndX = 0;
    console.log('yep');
    const threshold = 50; // Minimum swipe distance

    const container = this.elements.slideShowContainer;
    container.addEventListener('touchstart', e => {
      touchStartX = e.changedTouches[0].screenX;
    });
    container.addEventListener('touchend', e => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    });
    const handleSwipe = () => {
      if (!this.allowSlideNavigation) return;
      const delta = touchStartX - touchEndX;
      if (Math.abs(delta) > threshold) {
        const direction = delta > 0 ? 1 : -1;
        this.changeMedia(direction);
      }
    };
  }
  disableSlideNavigation() {
    this.allowSlideNavigation = false;
  }
  enableSlideNavigation() {
    this.allowSlideNavigation = true;
  }
  createNewMediaItem(type) {
    const elem = type === "video" ? document.createElement('video') : document.createElement('img');
    elem.classList.add('slideshow-media__item');
    return elem;
  }
  setMediaAttributes(elem, mediaElem, mediaType) {
    const mediaId = mediaElem.dataset.galleryId;
    elem.setAttribute('data-slideshow-id', mediaId);
    if (mediaType === "video") {
      elem.setAttribute('autoplay', '');
      elem.setAttribute('muted', '');
      elem.setAttribute('loop', '');
      const source = document.createElement('source');
      source.src = mediaElem.querySelector("source").src;
      source.type = "video/mp4";
      elem.appendChild(source);
    } else {
      elem.src = mediaElem.dataset.gallerySrc;
      elem.alt = mediaElem.alt || "Gallery Image";
    }
  }
  updateMinimapIndicator(mediaId = this.media[this.currentIndex]?.dataset.galleryId) {
    if (!mediaId) return;
    let miniMapWidth = this.elements.miniMap.offsetWidth;
    this.elements.miniMapItems.forEach((item, i) => {
      if (item.dataset.galleryId === mediaId) {
        item.classList.add('minimap-item--active');
        const targetX = -item.offsetLeft;
        gsap__WEBPACK_IMPORTED_MODULE_2__["default"].to(this.elements.miniMap, {
          x: targetX,
          duration: 0.4,
          ease: "power3.out"
        });
      } else {
        item.classList.remove('minimap-item--active');
      }
    });
  }

  // Check URL on Page Load & Open Slideshow if Needed
  checkURLForSlideShow() {
    window.addEventListener("DOMContentLoaded", () => {
      const urlParams = new URLSearchParams(window.location.search);
      const mediaId = urlParams.get("media");
      if (mediaId) {
        const mediaElement = document.querySelector(`[data-gallery-id="${mediaId}"]`);
        if (mediaElement) this.openSlideShow({
          target: mediaElement
        });
      }
    });
  }
  animateImages(useStrollTrigger, show = true) {
    let clipPathPoly = show ? "polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)" : "polygon(0% 100%, 100% 100%, 100% 100%, 0% 100%)";
    if (useStrollTrigger) {
      gsap__WEBPACK_IMPORTED_MODULE_2__["default"].to(this.elements.galleryItems, {
        clipPath: clipPathPoly,
        duration: 0.6,
        scrollTrigger: {
          trigger: this.elements.galleryItems,
          start: 'top bottom',
          scrub: false,
          markers: false
        },
        ease: "zoom"
      });
    } else {
      gsap__WEBPACK_IMPORTED_MODULE_2__["default"].to(this.elements.galleryItems, {
        clipPath: clipPathPoly,
        duration: 0.6,
        ease: "zoom"
      });
    }
  }
  animateAssets(tl, resolve) {
    super.animateAssets(tl, () => {
      this.animateImages(true);
      resolve();
    });
  }
  handleResize = () => {
    this.updateMinimapIndicator();
  };

  // Debounce helper (avoids spamming during resize)
  debounce(fn, delay = 100) {
    let timeout;
    return () => {
      clearTimeout(timeout);
      timeout = setTimeout(fn, delay);
    };
  }
  addEventListeners() {
    if (!this.elements.galleryItems || !this.elements.close) return;
    gsap__WEBPACK_IMPORTED_MODULE_2__["default"].set(this.elements.galleryItems, {
      clipPath: "polygon(0% 100%, 100% 100%, 100% 100%, 0% 100%)"
    });
    if (Array.isArray(this.elements.galleryItems) || typeof this.elements.galleryItems === 'object') {
      this.media = Array.from(this.elements.galleryItems);
      this.elements.galleryItems.forEach(element => {
        element.addEventListener('click', e => {
          this.openSlideShow(e);
        });
      });
    } else {
      this.elements.galleryItems.addEventListener('click', e => {
        this.openSlideShow(e);
      });
    }
    if (this.elements.prev) {
      this.elements.prev.addEventListener('click', () => {
        this.changeMedia(-1);
      });
    }
    if (this.elements.next) {
      this.elements.next.addEventListener('click', () => {
        this.changeMedia(1);
      });
    }
    this.elements.close.addEventListener('click', () => {
      this.closeSlideShow();
    });

    // ðŸ” Handle resize
    window.addEventListener('resize', this.debounce(this.handleResize));
  }
  init() {
    this.addEventListeners();
    this.checkURLForSlideShow();
    this.setupSwipeNavigation();
    this.setupScrollNavigation();
  }
}

/***/ })

},
/******/ function(__webpack_require__) { // webpackRuntimeModules
/******/ /* webpack/runtime/getFullHash */
/******/ (() => {
/******/ 	__webpack_require__.h = () => ("b07f0871732d7fdfecf5")
/******/ })();
/******/ 
/******/ }
);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LElBQUksQ0FBQzFELFFBQVEsQ0FBQ0ssSUFBSSxFQUFFO01BQ3JCLElBQUksQ0FBQ0wsUUFBUSxDQUFDSyxJQUFJLENBQUM0RSxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsTUFBTTtRQUNqRCxJQUFJLENBQUN2QixXQUFXLENBQUMsQ0FBQyxDQUFDO01BQ3JCLENBQUMsQ0FBQztJQUNKO0lBRUEsSUFBSSxDQUFDMUQsUUFBUSxDQUFDTSxLQUFLLENBQUMyRSxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsTUFBTTtNQUNsRCxJQUFJLENBQUN2QyxjQUFjLENBQUMsQ0FBQztJQUN2QixDQUFDLENBQUM7O0lBRUQ7SUFDRFUsTUFBTSxDQUFDNkIsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQytDLFFBQVEsQ0FBQyxJQUFJLENBQUNELFlBQVksQ0FBQyxDQUFDO0VBQ3JFO0VBRUExRyxJQUFJQSxDQUFBLEVBQUc7SUFDTCxJQUFJLENBQUNnSCxpQkFBaUIsQ0FBQyxDQUFDO0lBQ3hCLElBQUksQ0FBQ3BCLG9CQUFvQixDQUFDLENBQUM7SUFDM0IsSUFBSSxDQUFDN0Isb0JBQW9CLENBQUMsQ0FBQztJQUMzQixJQUFJLENBQUNMLHFCQUFxQixDQUFDLENBQUM7RUFDOUI7QUFDRixDOzs7Ozs7OztVQ3pYQSxzRCIsInNvdXJjZXMiOlsid2VicGFjazovL3Jvb20xODcvLi9hcHAvcGFnZXMvR2FsbGVyeS9pbmRleC5qcyIsIndlYnBhY2s6Ly9yb29tMTg3L3dlYnBhY2svcnVudGltZS9nZXRGdWxsSGFzaCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUGFnZSBmcm9tICdjbGFzc2VzL1BhZ2UnXG5pbXBvcnQgZ3NhcCBmcm9tICdnc2FwJ1xuaW1wb3J0IHsgc2Nyb2xsIH0gZnJvbSAndXRpbHMvTGVuaXNTY3JvbGwnXG5pbXBvcnQgeyBDdXN0b21FYXNlIH0gZnJvbSAnZ3NhcC9DdXN0b21FYXNlJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHYWxsZXJ5IGV4dGVuZHMgUGFnZSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKHtcbiAgICAgIGlkOiAnZ2FsbGVyeScsXG4gICAgICBlbGVtZW50czoge1xuICAgICAgICBnYWxsZXJ5OiAnW2RhdGEtZ2FsbGVyeV0nLFxuICAgICAgICBnYWxsZXJ5SXRlbXM6ICdbZGF0YS1nYWxsZXJ5LWl0ZW1dJyxcbiAgICAgICAgc2xpZGVTaG93OiAnW2RhdGEtc2xpZGVzaG93XScsXG4gICAgICAgIHByZXY6ICdbZGF0YS1zbGlkZXNob3ctcHJldl0nLFxuICAgICAgICBuZXh0OiAnW2RhdGEtc2xpZGVzaG93LW5leHRdJyxcbiAgICAgICAgY2xvc2U6ICdbZGF0YS1zbGlkZXNob3ddIFtkYXRhLWNsb3NlXScsXG4gICAgICAgIHNsaWRlU2hvd0NvbnRhaW5lcjogJ1tkYXRhLXNsaWRlc2hvdy1jb250YWluZXJdJyxcbiAgICAgICAgbWluaU1hcDogJ1tkYXRhLW1pbmktbWFwXScsXG4gICAgICAgIG1pbmlNYXBJdGVtczogJ1tkYXRhLW1pbmktbWFwLWl0ZW1dJ1xuICAgICAgfVxuICAgIH0pXG5cbiAgICBnc2FwLnJlZ2lzdGVyUGx1Z2luKEN1c3RvbUVhc2UpXG4gICAgQ3VzdG9tRWFzZS5jcmVhdGUoXCJ6b29tXCIsIFwiMC43MSwgMCwgMC4wNiwgMVwiKVxuXG4gICAgdGhpcy50bCA9IGdzYXAudGltZWxpbmUoKVxuICAgIHRoaXMuY3VycmVudEluZGV4ID0gMFxuICAgIHRoaXMubWVkaWEgPSBbXVxuICAgIHRoaXMuc2Nyb2xsID0gc2Nyb2xsXG4gICAgdGhpcy5oYXNNZWRpYUJlZW5TZXQgPSBmYWxzZVxuICAgIHRoaXMuaXNIb3ZlcmVkID0gZmFsc2VcbiAgICB0aGlzLnNjcm9sbFNwZWVkID0gMVxuICAgIHRoaXMuZHVwbGljYXRlZEl0ZW1zID0gW11cblxuICAgIHRoaXMuYWxsb3dTbGlkZU5hdmlnYXRpb24gPSBmYWxzZVxuICAgIFxuICAgIHRoaXMuaW5pdCgpXG4gIH1cblxuICBvcGVuU2xpZGVTaG93KGUpIHtcbiAgICBjb25zdCBtZWRpYUVsZW1lbnQgPSBlLnRhcmdldDtcbiAgICBjb25zdCBtZWRpYUlkID0gbWVkaWFFbGVtZW50LmRhdGFzZXQuZ2FsbGVyeUlkO1xuXG4gICAgdGhpcy5jdXJyZW50SW5kZXggPSB0aGlzLm1lZGlhLmZpbmRJbmRleChtZWRpYSA9PiBtZWRpYS5kYXRhc2V0LmdhbGxlcnlJZCA9PT0gbWVkaWFJZClcbiAgICB0aGlzLnNjcm9sbC5zdG9wKClcbiAgICB0aGlzLnRsLmNsZWFyKClcblxuICAgIHRoaXMudGwudG8odGhpcy5lbGVtZW50cy5nYWxsZXJ5SXRlbXMsIHsgXG4gICAgICBjbGlwUGF0aDogXCJwb2x5Z29uKDAlIDEwMCUsIDEwMCUgMTAwJSwgMTAwJSAxMDAlLCAwJSAxMDAlKVwiLCBcbiAgICAgIGR1cmF0aW9uOiAwLjYsXG4gICAgICBlYXNlOiBcInpvb21cIlxuICAgIH0pXG5cbiAgICB0aGlzLnRsLnRvKHRoaXMuZWxlbWVudHMuc2xpZGVTaG93LCB7XG4gICAgICBjbGlwUGF0aDogXCJwb2x5Z29uKDAlIDAlLCAxMDAlIDAlLCAxMDAlIDEwMCUsIDAlIDEwMCUpXCIsXG4gICAgICBkdXJhdGlvbjogMC42LFxuICAgICAgZWFzZTogXCJ6b29tXCIsXG4gICAgICBvbkNvbXBsZXRlOiAoKSA9PiB7XG4gICAgICAgIHRoaXMuZWxlbWVudHMuc2xpZGVTaG93LmNsYXNzTGlzdC5yZW1vdmUoJ2Nhbm5vdC1pbnRlcmFjdCcpXG4gICAgICAgIHRoaXMuc2hvd01lZGlhKClcbiAgICAgICAgdGhpcy5lbmFibGVTbGlkZU5hdmlnYXRpb24oKVxuICAgICAgfVxuICAgIH0pXG5cbiAgICB0aGlzLnRsLnRvKHRoaXMuZWxlbWVudHMuY2xvc2UsIHsgb3BhY2l0eTogMSwgZHVyYXRpb246IDAuMywgZWFzZTogXCJwb3dlcjIub3V0XCIgfSlcbiAgICB0aGlzLnRsLnRvKHRoaXMuZWxlbWVudHMucHJldiwgeyBvcGFjaXR5OiAxLCBkdXJhdGlvbjogMC4zLCBlYXNlOiBcInBvd2VyMi5vdXRcIiB9LCAnY29udHJvbHMnKVxuICAgIHRoaXMudGwudG8odGhpcy5lbGVtZW50cy5uZXh0LCB7IG9wYWNpdHk6IDEsIGR1cmF0aW9uOiAwLjMsIGVhc2U6IFwicG93ZXIyLm91dFwiIH0sICdjb250cm9scycpXG4gIH1cblxuICBjbG9zZVNsaWRlU2hvdygpIHtcbiAgICB0aGlzLmRpc2FibGVTbGlkZU5hdmlnYXRpb24oKVxuICAgIGxldCBzbGlkZVNob3dNZWRpYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zbGlkZXNob3ctbWVkaWFfX2l0ZW0nKVxuICAgIHRoaXMuZWxlbWVudHMuc2xpZGVTaG93LmNsYXNzTGlzdC5hZGQoJ2Nhbm5vdC1pbnRlcmFjdCcpXG5cbiAgICB0aGlzLnRsLnRvKHRoaXMuZWxlbWVudHMuc2xpZGVTaG93LCB7XG4gICAgICBjbGlwUGF0aDogXCJwb2x5Z29uKDAlIDEwMCUsIDEwMCUgMTAwJSwgMTAwJSAxMDAlLCAwJSAxMDAlKVwiLFxuICAgICAgZHVyYXRpb246IDAuNixcbiAgICAgIGVhc2U6IFwiem9vbVwiLFxuICAgICAgb25Db21wbGV0ZTogKCkgPT4ge1xuICAgICAgICBzbGlkZVNob3dNZWRpYS5yZW1vdmUoKVxuICAgICAgICB0aGlzLmhhc01lZGlhQmVlblNldCA9IGZhbHNlXG4gICAgICAgIHRoaXMuc2Nyb2xsLnN0YXJ0KClcbiAgICAgICAgdGhpcy5hbmltYXRlSW1hZ2VzKGZhbHNlLCB0cnVlKVxuICAgICAgfVxuICAgIH0pXG5cbiAgICB0aGlzLnRsLnRvKHRoaXMuZWxlbWVudHMuY2xvc2UsIHsgb3BhY2l0eTogMCwgZHVyYXRpb246IDAuMDAxIH0sICdoaWRlJylcbiAgICB0aGlzLnRsLnRvKHRoaXMuZWxlbWVudHMucHJldiwgeyBvcGFjaXR5OiAwLCBkdXJhdGlvbjogMC4wMDEgfSwgJ2hpZGUnKVxuICAgIHRoaXMudGwudG8odGhpcy5lbGVtZW50cy5uZXh0LCB7IG9wYWNpdHk6IDAsIGR1cmF0aW9uOiAwLjAwMSB9LCAnaGlkZScpXG4gICAgXG4gICAgLy8gUmVtb3ZlIGltYWdlIHBhcmFtZXRlciBmcm9tIFVSTFxuICAgIGNvbnN0IG5ld1VybCA9IG5ldyBVUkwod2luZG93LmxvY2F0aW9uKTtcbiAgICBuZXdVcmwuc2VhcmNoUGFyYW1zLmRlbGV0ZShcIm1lZGlhXCIpO1xuICAgIHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSh7fSwgXCJcIiwgbmV3VXJsKTtcbiAgfVxuICBcbiAgY2hhbmdlTWVkaWEoZGlyZWN0aW9uKSB7XG4gICAgY29uc3Qgb2xkSW5kZXggPSB0aGlzLmN1cnJlbnRJbmRleFxuICAgIHRoaXMuY3VycmVudEluZGV4ID0gKHRoaXMuY3VycmVudEluZGV4ICsgZGlyZWN0aW9uICsgdGhpcy5tZWRpYS5sZW5ndGgpICUgdGhpcy5tZWRpYS5sZW5ndGhcbiAgICBcbiAgICBpZiAob2xkSW5kZXggPT09IHRoaXMuY3VycmVudEluZGV4KSByZXR1cm5cblxuICAgIGlmICh0aGlzLnRsLmlzQWN0aXZlKCkpIHtcbiAgICAgIHRoaXMudGwuYWRkKCgpID0+IHtcbiAgICAgICAgdGhpcy5zaG93TWVkaWEoKTtcbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2hvd01lZGlhKCk7XG4gICAgfVxuICB9XG5cbiAgc2hvd01lZGlhKCkge1xuICAgIGNvbnN0IG1lZGlhQ3VycmVudEVsZW0gPSB0aGlzLm1lZGlhW3RoaXMuY3VycmVudEluZGV4XVxuICAgIGNvbnN0IG1lZGlhVHlwZSA9IG1lZGlhQ3VycmVudEVsZW0uZGF0YXNldC5nYWxsZXJ5SXRlbVxuICAgIGNvbnN0IG1lZGlhSWQgPSBtZWRpYUN1cnJlbnRFbGVtLmRhdGFzZXQuZ2FsbGVyeUlkO1xuICAgIFxuICAgIHRoaXMudXBkYXRlTWluaW1hcEluZGljYXRvcihtZWRpYUlkKVxuXG4gICAgLy8gSWYgdGhlIHNhbWUgbWVkaWEsIGRvbid0IGRvIGFueXRoaW5nXG4gICAgaWYgKHRoaXMuZWxlbWVudHMuc2xpZGVTaG93Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXNsaWRlc2hvdy1pZD1cIiR7bWVkaWFJZH1cIl1gKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5oYXNNZWRpYUJlZW5TZXQpIHtcbiAgICAgIHRoaXMuY3JlYXRlQW5kU2V0TWVkaWFFbGVtZW50KG1lZGlhQ3VycmVudEVsZW0sIG1lZGlhVHlwZSlcbiAgICAgIHRoaXMuaGFzTWVkaWFCZWVuU2V0ID0gdHJ1ZVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnN3YXBNZWRpYUVsZW1lbnQobWVkaWFDdXJyZW50RWxlbSwgbWVkaWFUeXBlKVxuICAgIH1cblxuICAgIC8vIFVwZGF0ZSB0aGUgVVJMIHdpdGggdGhlIG5ldyBpbWFnZSBJRFxuICAgIGNvbnN0IG5ld1VybCA9IG5ldyBVUkwod2luZG93LmxvY2F0aW9uKVxuICAgIG5ld1VybC5zZWFyY2hQYXJhbXMuc2V0KFwibWVkaWFcIiwgbWVkaWFJZClcbiAgICB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUoe30sIFwiXCIsIG5ld1VybClcbiAgICBcbiAgfVxuXG4gIGNyZWF0ZUFuZFNldE1lZGlhRWxlbWVudChtZWRpYUVsZW0sIG1lZGlhVHlwZSkge1xuICAgIGNvbnN0IG5ld0VsZW0gPSB0aGlzLmNyZWF0ZU5ld01lZGlhSXRlbShtZWRpYVR5cGUpXG4gICAgdGhpcy5zZXRNZWRpYUF0dHJpYnV0ZXMobmV3RWxlbSwgbWVkaWFFbGVtLCBtZWRpYVR5cGUpXG5cbiAgICB0aGlzLmVsZW1lbnRzLnNsaWRlU2hvd0NvbnRhaW5lci5pbm5lckhUTUwgPSAnJyAvLyBDbGVhciBwcmV2aW91cyBlbGVtZW50c1xuICAgIHRoaXMuZWxlbWVudHMuc2xpZGVTaG93Q29udGFpbmVyLmFwcGVuZENoaWxkKG5ld0VsZW0pXG5cbiAgICBnc2FwLmZyb21UbyhuZXdFbGVtLCB7IGNsaXBQYXRoOiBcInBvbHlnb24oMCUgMTAwJSwgMTAwJSAxMDAlLCAxMDAlIDEwMCUsIDAlIDEwMCUpXCIgfSwgeyBjbGlwUGF0aDogXCJwb2x5Z29uKDAlIDAlLCAxMDAlIDAlLCAxMDAlIDEwMCUsIDAlIDEwMCUpXCIsIGR1cmF0aW9uOiAwLjYsIGVhc2U6IFwiem9vbVwiIH0pXG4gIH1cblxuICBzd2FwTWVkaWFFbGVtZW50KG1lZGlhRWxlbSwgbWVkaWFUeXBlKSB7XG4gICAgY29uc3Qgb2xkRWxlbSA9IHRoaXMuZWxlbWVudHMuc2xpZGVTaG93Q29udGFpbmVyLmZpcnN0Q2hpbGRcbiAgICBjb25zdCBuZXdFbGVtID0gdGhpcy5jcmVhdGVOZXdNZWRpYUl0ZW0obWVkaWFUeXBlKVxuICAgIHRoaXMuc2V0TWVkaWFBdHRyaWJ1dGVzKG5ld0VsZW0sIG1lZGlhRWxlbSwgbWVkaWFUeXBlKVxuXG4gICAgdGhpcy5lbGVtZW50cy5zbGlkZVNob3dDb250YWluZXIuYXBwZW5kQ2hpbGQobmV3RWxlbSlcblxuICAgIHRoaXMudGwuZnJvbVRvKG5ld0VsZW0sIHsgY2xpcFBhdGg6IFwicG9seWdvbigwJSAxMDAlLCAxMDAlIDEwMCUsIDEwMCUgMTAwJSwgMCUgMTAwJSlcIiB9LCB7IGNsaXBQYXRoOiBcInBvbHlnb24oMCUgMCUsIDEwMCUgMCUsIDEwMCUgMTAwJSwgMCUgMTAwJSlcIiwgZHVyYXRpb246IDAuNiwgZWFzZTogXCJ6b29tXCIgfSlcbiAgICBcbiAgICB0aGlzLnRsLnRvKG9sZEVsZW0sIHtcbiAgICAgIGNsaXBQYXRoOiBcInBvbHlnb24oMCUgMTAwJSwgMTAwJSAxMDAlLCAxMDAlIDEwMCUsIDAlIDEwMCUpXCIsXG4gICAgICBkdXJhdGlvbjogMC42LFxuICAgICAgZWFzZTogXCJwb3dlcjIub3V0XCIsXG4gICAgICBvbkNvbXBsZXRlOiAoKSA9PiB7XG4gICAgICAgIG9sZEVsZW0ucmVtb3ZlKClcbiAgICAgIH1cbiAgICB9LCBcIi09MC4yXCIpXG4gIH1cblxuICBzZXR1cFNjcm9sbE5hdmlnYXRpb24oKSB7XG4gICAgbGV0IHRpY2tpbmcgPSBmYWxzZTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIChlKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuYWxsb3dTbGlkZU5hdmlnYXRpb24gfHwgdGlja2luZykgcmV0dXJuO1xuXG4gICAgICB0aWNraW5nID0gdHJ1ZTtcbiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IGUuZGVsdGFZID4gMCA/IDEgOiAtMTtcblxuICAgICAgdGhpcy5jaGFuZ2VNZWRpYShkaXJlY3Rpb24pO1xuXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGlja2luZyA9IGZhbHNlO1xuICAgICAgfSwgNjAwKTsgLy8gZGVsYXkgdG8gcHJldmVudCBvdmVyc2Nyb2xsXG4gICAgfSk7XG4gIH1cblxuICBzZXR1cFN3aXBlTmF2aWdhdGlvbigpIHtcbiAgICBsZXQgdG91Y2hTdGFydFggPSAwO1xuICAgIGxldCB0b3VjaEVuZFggPSAwO1xuXG4gICAgY29uc29sZS5sb2coJ3llcCcpXG5cbiAgICBjb25zdCB0aHJlc2hvbGQgPSA1MDsgLy8gTWluaW11bSBzd2lwZSBkaXN0YW5jZVxuXG4gICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5lbGVtZW50cy5zbGlkZVNob3dDb250YWluZXI7XG5cbiAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIChlKSA9PiB7XG4gICAgICB0b3VjaFN0YXJ0WCA9IGUuY2hhbmdlZFRvdWNoZXNbMF0uc2NyZWVuWDtcbiAgICB9KTtcblxuICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIChlKSA9PiB7XG4gICAgICB0b3VjaEVuZFggPSBlLmNoYW5nZWRUb3VjaGVzWzBdLnNjcmVlblg7XG4gICAgICBoYW5kbGVTd2lwZSgpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgaGFuZGxlU3dpcGUgPSAoKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuYWxsb3dTbGlkZU5hdmlnYXRpb24pIHJldHVybjtcbiAgICAgIGNvbnN0IGRlbHRhID0gdG91Y2hTdGFydFggLSB0b3VjaEVuZFg7XG4gICAgICBcbiAgICAgIGlmIChNYXRoLmFicyhkZWx0YSkgPiB0aHJlc2hvbGQpIHtcbiAgICAgICAgY29uc3QgZGlyZWN0aW9uID0gZGVsdGEgPiAwID8gMSA6IC0xO1xuICAgICAgICB0aGlzLmNoYW5nZU1lZGlhKGRpcmVjdGlvbik7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIGRpc2FibGVTbGlkZU5hdmlnYXRpb24oKSB7XG4gICAgdGhpcy5hbGxvd1NsaWRlTmF2aWdhdGlvbiA9IGZhbHNlO1xuICB9XG5cbiAgZW5hYmxlU2xpZGVOYXZpZ2F0aW9uKCkge1xuICAgIHRoaXMuYWxsb3dTbGlkZU5hdmlnYXRpb24gPSB0cnVlO1xuICB9XG5cbiAgY3JlYXRlTmV3TWVkaWFJdGVtKHR5cGUpIHtcbiAgICBjb25zdCBlbGVtID0gdHlwZSA9PT0gXCJ2aWRlb1wiID8gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndmlkZW8nKSA6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpXG4gICAgZWxlbS5jbGFzc0xpc3QuYWRkKCdzbGlkZXNob3ctbWVkaWFfX2l0ZW0nKVxuICAgIHJldHVybiBlbGVtXG4gIH1cblxuICBzZXRNZWRpYUF0dHJpYnV0ZXMoZWxlbSwgbWVkaWFFbGVtLCBtZWRpYVR5cGUpIHtcbiAgICBjb25zdCBtZWRpYUlkID0gbWVkaWFFbGVtLmRhdGFzZXQuZ2FsbGVyeUlkXG5cbiAgICBlbGVtLnNldEF0dHJpYnV0ZSgnZGF0YS1zbGlkZXNob3ctaWQnLCBtZWRpYUlkKVxuXG4gICAgaWYgKG1lZGlhVHlwZSA9PT0gXCJ2aWRlb1wiKSB7XG4gICAgICBlbGVtLnNldEF0dHJpYnV0ZSgnYXV0b3BsYXknLCAnJylcbiAgICAgIGVsZW0uc2V0QXR0cmlidXRlKCdtdXRlZCcsICcnKVxuICAgICAgZWxlbS5zZXRBdHRyaWJ1dGUoJ2xvb3AnLCAnJylcblxuICAgICAgY29uc3Qgc291cmNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJylcbiAgICAgIHNvdXJjZS5zcmMgPSBtZWRpYUVsZW0ucXVlcnlTZWxlY3RvcihcInNvdXJjZVwiKS5zcmNcbiAgICAgIHNvdXJjZS50eXBlID0gXCJ2aWRlby9tcDRcIlxuICAgICAgZWxlbS5hcHBlbmRDaGlsZChzb3VyY2UpXG4gICAgfSBlbHNlIHtcbiAgICAgIGVsZW0uc3JjID0gbWVkaWFFbGVtLmRhdGFzZXQuZ2FsbGVyeVNyY1xuICAgICAgZWxlbS5hbHQgPSBtZWRpYUVsZW0uYWx0IHx8IFwiR2FsbGVyeSBJbWFnZVwiXG4gICAgfVxuICB9XG5cbiAgdXBkYXRlTWluaW1hcEluZGljYXRvcihtZWRpYUlkID0gdGhpcy5tZWRpYVt0aGlzLmN1cnJlbnRJbmRleF0/LmRhdGFzZXQuZ2FsbGVyeUlkKSB7XG4gICAgaWYgKCFtZWRpYUlkKSByZXR1cm5cbiAgICBsZXQgbWluaU1hcFdpZHRoID0gdGhpcy5lbGVtZW50cy5taW5pTWFwLm9mZnNldFdpZHRoXG5cbiAgICB0aGlzLmVsZW1lbnRzLm1pbmlNYXBJdGVtcy5mb3JFYWNoKChpdGVtLCBpKSA9PiB7XG4gICAgICBpZiAoaXRlbS5kYXRhc2V0LmdhbGxlcnlJZCA9PT0gbWVkaWFJZCkge1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ21pbmltYXAtaXRlbS0tYWN0aXZlJylcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHRhcmdldFggPSAtaXRlbS5vZmZzZXRMZWZ0XG4gICAgICAgIFxuICAgICAgICBnc2FwLnRvKHRoaXMuZWxlbWVudHMubWluaU1hcCwge1xuICAgICAgICAgIHg6IHRhcmdldFgsXG4gICAgICAgICAgZHVyYXRpb246IDAuNCxcbiAgICAgICAgICBlYXNlOiBcInBvd2VyMy5vdXRcIlxuICAgICAgICB9KVxuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ21pbmltYXAtaXRlbS0tYWN0aXZlJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvLyBDaGVjayBVUkwgb24gUGFnZSBMb2FkICYgT3BlbiBTbGlkZXNob3cgaWYgTmVlZGVkXG4gIGNoZWNrVVJMRm9yU2xpZGVTaG93KCkge1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCB1cmxQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpO1xuICAgICAgY29uc3QgbWVkaWFJZCA9IHVybFBhcmFtcy5nZXQoXCJtZWRpYVwiKTtcbiAgXG4gICAgICBpZiAobWVkaWFJZCkge1xuICAgICAgICBjb25zdCBtZWRpYUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1nYWxsZXJ5LWlkPVwiJHttZWRpYUlkfVwiXWApO1xuICAgICAgICBpZiAobWVkaWFFbGVtZW50KSB0aGlzLm9wZW5TbGlkZVNob3coeyB0YXJnZXQ6IG1lZGlhRWxlbWVudCB9KTtcbiAgICAgIH1cbiAgICB9KVxuICB9XG4gIFxuICBhbmltYXRlSW1hZ2VzKHVzZVN0cm9sbFRyaWdnZXIsIHNob3cgPSB0cnVlKSB7XG4gICAgbGV0IGNsaXBQYXRoUG9seSA9IHNob3c/IFwicG9seWdvbigwJSAwJSwgMTAwJSAwJSwgMTAwJSAxMDAlLCAwJSAxMDAlKVwiIDogXCJwb2x5Z29uKDAlIDEwMCUsIDEwMCUgMTAwJSwgMTAwJSAxMDAlLCAwJSAxMDAlKVwiIFxuXG4gICAgaWYodXNlU3Ryb2xsVHJpZ2dlcikge1xuICAgICAgZ3NhcC50byh0aGlzLmVsZW1lbnRzLmdhbGxlcnlJdGVtcyxcbiAgICAgICAge1xuICAgICAgICAgIGNsaXBQYXRoOiBjbGlwUGF0aFBvbHksXG4gICAgICAgICAgZHVyYXRpb246IDAuNixcbiAgICAgICAgICBzY3JvbGxUcmlnZ2VyOiB7XG4gICAgICAgICAgICB0cmlnZ2VyOiB0aGlzLmVsZW1lbnRzLmdhbGxlcnlJdGVtcyxcbiAgICAgICAgICAgIHN0YXJ0OiAndG9wIGJvdHRvbScsXG4gICAgICAgICAgICBzY3J1YjogZmFsc2UsXG4gICAgICAgICAgICBtYXJrZXJzOiBmYWxzZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZWFzZTogXCJ6b29tXCJcbiAgICAgICAgfVxuICAgICAgKVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGdzYXAudG8odGhpcy5lbGVtZW50cy5nYWxsZXJ5SXRlbXMsXG4gICAgICAgIHtcbiAgICAgICAgICBjbGlwUGF0aDogY2xpcFBhdGhQb2x5LFxuICAgICAgICAgIGR1cmF0aW9uOiAwLjYsXG4gICAgICAgICAgZWFzZTogXCJ6b29tXCJcbiAgICAgICAgfVxuICAgICAgKVxuICAgIH1cbiAgfVxuXG4gIGFuaW1hdGVBc3NldHModGwsIHJlc29sdmUpIHtcbiAgICBzdXBlci5hbmltYXRlQXNzZXRzKHRsLCAoKSA9PiB7XG4gICAgICB0aGlzLmFuaW1hdGVJbWFnZXModHJ1ZSlcblxuICAgICAgcmVzb2x2ZSgpXG4gICAgfSlcbiAgfVxuXG4gIGhhbmRsZVJlc2l6ZSA9ICgpID0+IHtcbiAgICB0aGlzLnVwZGF0ZU1pbmltYXBJbmRpY2F0b3IoKVxuICB9XG5cbiAgLy8gRGVib3VuY2UgaGVscGVyIChhdm9pZHMgc3BhbW1pbmcgZHVyaW5nIHJlc2l6ZSlcbiAgZGVib3VuY2UoZm4sIGRlbGF5ID0gMTAwKSB7XG4gICAgbGV0IHRpbWVvdXRcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpXG4gICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChmbiwgZGVsYXkpXG4gICAgfVxuICB9XG5cbiAgYWRkRXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgaWYoIXRoaXMuZWxlbWVudHMuZ2FsbGVyeUl0ZW1zIHx8ICF0aGlzLmVsZW1lbnRzLmNsb3NlKSByZXR1cm5cblxuICAgIGdzYXAuc2V0KHRoaXMuZWxlbWVudHMuZ2FsbGVyeUl0ZW1zLCB7IGNsaXBQYXRoOiBcInBvbHlnb24oMCUgMTAwJSwgMTAwJSAxMDAlLCAxMDAlIDEwMCUsIDAlIDEwMCUpXCJ9KVxuICAgIFxuICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMuZWxlbWVudHMuZ2FsbGVyeUl0ZW1zKSB8fCAodHlwZW9mIHRoaXMuZWxlbWVudHMuZ2FsbGVyeUl0ZW1zID09PSAnb2JqZWN0JykpIHtcbiAgICAgIHRoaXMubWVkaWEgPSBBcnJheS5mcm9tKHRoaXMuZWxlbWVudHMuZ2FsbGVyeUl0ZW1zKVxuICAgICAgdGhpcy5lbGVtZW50cy5nYWxsZXJ5SXRlbXMuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgdGhpcy5vcGVuU2xpZGVTaG93KGUpXG4gICAgICAgIH0pXG4gICAgICB9KTtcbiAgICAgIFxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmVsZW1lbnRzLmdhbGxlcnlJdGVtcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgIHRoaXMub3BlblNsaWRlU2hvdyhlKVxuICAgICAgfSlcbiAgICB9XG5cbiAgICBpZih0aGlzLmVsZW1lbnRzLnByZXYpIHtcbiAgICAgIHRoaXMuZWxlbWVudHMucHJldi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgdGhpcy5jaGFuZ2VNZWRpYSgtMSlcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgaWYodGhpcy5lbGVtZW50cy5uZXh0KSB7XG4gICAgICB0aGlzLmVsZW1lbnRzLm5leHQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuY2hhbmdlTWVkaWEoMSlcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgdGhpcy5lbGVtZW50cy5jbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIHRoaXMuY2xvc2VTbGlkZVNob3coKVxuICAgIH0pXG5cbiAgICAgLy8g8J+UgSBIYW5kbGUgcmVzaXplXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMuZGVib3VuY2UodGhpcy5oYW5kbGVSZXNpemUpKVxuICB9XG5cbiAgaW5pdCgpIHtcbiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXJzKClcbiAgICB0aGlzLmNoZWNrVVJMRm9yU2xpZGVTaG93KClcbiAgICB0aGlzLnNldHVwU3dpcGVOYXZpZ2F0aW9uKClcbiAgICB0aGlzLnNldHVwU2Nyb2xsTmF2aWdhdGlvbigpXG4gIH1cbn0iLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmggPSAoKSA9PiAoXCJiMDdmMDg3MTczMmQ3ZmRmZWNmNVwiKSJdLCJuYW1lcyI6WyJQYWdlIiwiZ3NhcCIsInNjcm9sbCIsIkN1c3RvbUVhc2UiLCJHYWxsZXJ5IiwiY29uc3RydWN0b3IiLCJpZCIsImVsZW1lbnRzIiwiZ2FsbGVyeSIsImdhbGxlcnlJdGVtcyIsInNsaWRlU2hvdyIsInByZXYiLCJuZXh0IiwiY2xvc2UiLCJzbGlkZVNob3dDb250YWluZXIiLCJtaW5pTWFwIiwibWluaU1hcEl0ZW1zIiwicmVnaXN0ZXJQbHVnaW4iLCJjcmVhdGUiLCJ0bCIsInRpbWVsaW5lIiwiY3VycmVudEluZGV4IiwibWVkaWEiLCJoYXNNZWRpYUJlZW5TZXQiLCJpc0hvdmVyZWQiLCJzY3JvbGxTcGVlZCIsImR1cGxpY2F0ZWRJdGVtcyIsImFsbG93U2xpZGVOYXZpZ2F0aW9uIiwiaW5pdCIsIm9wZW5TbGlkZVNob3ciLCJlIiwibWVkaWFFbGVtZW50IiwidGFyZ2V0IiwibWVkaWFJZCIsImRhdGFzZXQiLCJnYWxsZXJ5SWQiLCJmaW5kSW5kZXgiLCJzdG9wIiwiY2xlYXIiLCJ0byIsImNsaXBQYXRoIiwiZHVyYXRpb24iLCJlYXNlIiwib25Db21wbGV0ZSIsImNsYXNzTGlzdCIsInJlbW92ZSIsInNob3dNZWRpYSIsImVuYWJsZVNsaWRlTmF2aWdhdGlvbiIsIm9wYWNpdHkiLCJjbG9zZVNsaWRlU2hvdyIsImRpc2FibGVTbGlkZU5hdmlnYXRpb24iLCJzbGlkZVNob3dNZWRpYSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImFkZCIsInN0YXJ0IiwiYW5pbWF0ZUltYWdlcyIsIm5ld1VybCIsIlVSTCIsIndpbmRvdyIsImxvY2F0aW9uIiwic2VhcmNoUGFyYW1zIiwiZGVsZXRlIiwiaGlzdG9yeSIsInB1c2hTdGF0ZSIsImNoYW5nZU1lZGlhIiwiZGlyZWN0aW9uIiwib2xkSW5kZXgiLCJsZW5ndGgiLCJpc0FjdGl2ZSIsIm1lZGlhQ3VycmVudEVsZW0iLCJtZWRpYVR5cGUiLCJnYWxsZXJ5SXRlbSIsInVwZGF0ZU1pbmltYXBJbmRpY2F0b3IiLCJjcmVhdGVBbmRTZXRNZWRpYUVsZW1lbnQiLCJzd2FwTWVkaWFFbGVtZW50Iiwic2V0IiwibWVkaWFFbGVtIiwibmV3RWxlbSIsImNyZWF0ZU5ld01lZGlhSXRlbSIsInNldE1lZGlhQXR0cmlidXRlcyIsImlubmVySFRNTCIsImFwcGVuZENoaWxkIiwiZnJvbVRvIiwib2xkRWxlbSIsImZpcnN0Q2hpbGQiLCJzZXR1cFNjcm9sbE5hdmlnYXRpb24iLCJ0aWNraW5nIiwiYWRkRXZlbnRMaXN0ZW5lciIsImRlbHRhWSIsInNldFRpbWVvdXQiLCJzZXR1cFN3aXBlTmF2aWdhdGlvbiIsInRvdWNoU3RhcnRYIiwidG91Y2hFbmRYIiwiY29uc29sZSIsImxvZyIsInRocmVzaG9sZCIsImNvbnRhaW5lciIsImNoYW5nZWRUb3VjaGVzIiwic2NyZWVuWCIsImhhbmRsZVN3aXBlIiwiZGVsdGEiLCJNYXRoIiwiYWJzIiwidHlwZSIsImVsZW0iLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwic291cmNlIiwic3JjIiwiZ2FsbGVyeVNyYyIsImFsdCIsIm1pbmlNYXBXaWR0aCIsIm9mZnNldFdpZHRoIiwiZm9yRWFjaCIsIml0ZW0iLCJpIiwidGFyZ2V0WCIsIm9mZnNldExlZnQiLCJ4IiwiY2hlY2tVUkxGb3JTbGlkZVNob3ciLCJ1cmxQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJzZWFyY2giLCJnZXQiLCJ1c2VTdHJvbGxUcmlnZ2VyIiwic2hvdyIsImNsaXBQYXRoUG9seSIsInNjcm9sbFRyaWdnZXIiLCJ0cmlnZ2VyIiwic2NydWIiLCJtYXJrZXJzIiwiYW5pbWF0ZUFzc2V0cyIsInJlc29sdmUiLCJoYW5kbGVSZXNpemUiLCJkZWJvdW5jZSIsImZuIiwiZGVsYXkiLCJ0aW1lb3V0IiwiY2xlYXJUaW1lb3V0IiwiYWRkRXZlbnRMaXN0ZW5lcnMiLCJBcnJheSIsImlzQXJyYXkiLCJmcm9tIiwiZWxlbWVudCJdLCJzb3VyY2VSb290IjoiIn0=