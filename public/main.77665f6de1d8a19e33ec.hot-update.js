"use strict";
self["webpackHotUpdateroom187"]("main",{

/***/ "./app/pages/Gallery/index.js":
/*!************************************!*\
  !*** ./app/pages/Gallery/index.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Gallery)
/* harmony export */ });
/* harmony import */ var classes_Page__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! classes/Page */ "./app/classes/Page.js");
/* harmony import */ var gsap__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! gsap */ "./node_modules/gsap/index.js");
/* harmony import */ var utils_LenisScroll__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! utils/LenisScroll */ "./app/utils/LenisScroll.js");
/* harmony import */ var gsap_CustomEase__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! gsap/CustomEase */ "./node_modules/gsap/CustomEase.js");




class Gallery extends classes_Page__WEBPACK_IMPORTED_MODULE_0__["default"] {
  constructor() {
    super({
      id: 'gallery',
      elements: {
        gallery: '[data-gallery]',
        galleryItems: '[data-gallery-item]',
        slideShow: '[data-slideshow]',
        prev: '[data-slideshow-prev]',
        next: '[data-slideshow-next]',
        close: '[data-slideshow] [data-close]',
        slideShowContainer: '[data-slideshow-container]',
        slideShowCounter: '[data-slideshow-index]',
        miniMap: '[data-mini-map]',
        miniMapItems: '[data-mini-map-item]',
        miniMapIndicator: '[data-mini-map-indicator]'
      }
    });
    gsap__WEBPACK_IMPORTED_MODULE_2__["default"].registerPlugin(gsap_CustomEase__WEBPACK_IMPORTED_MODULE_3__.CustomEase);
    gsap_CustomEase__WEBPACK_IMPORTED_MODULE_3__.CustomEase.create("zoom", "0.71, 0, 0.06, 1");
    this.tl = gsap__WEBPACK_IMPORTED_MODULE_2__["default"].timeline();
    this.currentIndex = 0;
    this.media = [];
    this.scroll = utils_LenisScroll__WEBPACK_IMPORTED_MODULE_1__.scroll;
    this.hasMediaBeenSet = false;
    this.allowSlideNavigation = false;
    this.init();
  }
  openSlideShow(e) {
    const mediaElement = e.target;
    const mediaId = mediaElement.dataset.galleryId;
    this.currentIndex = this.media.findIndex(media => media.dataset.galleryId === mediaId);
    this.displayIndex();
    this.scroll.stop();
    this.tl.clear();
    this.updateMinimapIndicator(mediaId, true);
    this.tl.to(this.elements.galleryItems, {
      clipPath: "polygon(0% 100%, 100% 100%, 100% 100%, 0% 100%)",
      duration: 0.4,
      ease: "zoom"
    });
    this.tl.to(this.elements.slideShow, {
      clipPath: "polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)",
      duration: 0.6,
      ease: "zoom",
      onComplete: () => {
        this.elements.slideShow.classList.remove('cannot-interact');
        this.showMedia();
        this.enableSlideNavigation();
      }
    }, '-=0.2');
    this.tl.to(this.elements.close, {
      opacity: 1,
      duration: 0.3,
      ease: "power2.out"
    });
    this.tl.to(this.elements.prev, {
      opacity: 1,
      duration: 0.3,
      ease: "power2.out"
    }, 'controls');
    this.tl.to(this.elements.next, {
      opacity: 1,
      duration: 0.3,
      ease: "power2.out"
    }, 'controls');
  }
  closeSlideShow() {
    this.disableSlideNavigation();
    let slideShowMedia = document.querySelector('.slideshow-media__item');
    this.elements.slideShow.classList.add('cannot-interact');
    this.tl.to(this.elements.slideShow, {
      clipPath: "polygon(0% 100%, 100% 100%, 100% 100%, 0% 100%)",
      duration: 0.6,
      ease: "zoom",
      onComplete: () => {
        slideShowMedia.remove();
        this.hasMediaBeenSet = false;
        this.scroll.start();
        this.animateImages(false, true);
      }
    });
    this.tl.to(this.elements.close, {
      opacity: 0,
      duration: 0.001
    }, 'hide');
    this.tl.to(this.elements.prev, {
      opacity: 0,
      duration: 0.001
    }, 'hide');
    this.tl.to(this.elements.next, {
      opacity: 0,
      duration: 0.001
    }, 'hide');

    // Remove image parameter from URL
    const newUrl = new URL(window.location);
    newUrl.searchParams.delete("media");
    window.history.pushState({}, "", newUrl);
  }
  changeMedia(direction) {
    const oldIndex = this.currentIndex;
    this.currentIndex = (this.currentIndex + direction + this.media.length) % this.media.length;
    this.displayIndex();
    if (oldIndex === this.currentIndex) return;
    if (this.tl.isActive()) {
      this.tl.add(() => {
        this.showMedia();
      });
    } else {
      this.showMedia();
    }
  }
  showMedia() {
    const mediaCurrentElem = this.media[this.currentIndex];
    const mediaType = mediaCurrentElem.dataset.galleryItem;
    const mediaId = mediaCurrentElem.dataset.galleryId;
    this.updateMinimapIndicator(mediaId);

    // If the same media, don't do anything
    if (this.elements.slideShowContainer.querySelector(`[data-slideshow-id="${mediaId}"]`)) {
      return;
    }
    if (!this.hasMediaBeenSet) {
      this.createAndSetMediaElement(mediaCurrentElem, mediaType);
      this.hasMediaBeenSet = true;
    } else {
      this.swapMediaElement(mediaCurrentElem, mediaType);
    }

    // Update the URL with the new image ID
    const newUrl = new URL(window.location);
    newUrl.searchParams.set("media", mediaId);
    window.history.pushState({}, "", newUrl);
  }
  createAndSetMediaElement(mediaElem, mediaType) {
    const newElem = this.createNewMediaItem(mediaType);
    this.setMediaAttributes(newElem, mediaElem, mediaType);
    this.elements.slideShowContainer.innerHTML = ''; // Clear previous elements
    this.elements.slideShowContainer.appendChild(newElem);
    gsap__WEBPACK_IMPORTED_MODULE_2__["default"].fromTo(newElem, {
      clipPath: "polygon(0% 100%, 100% 100%, 100% 100%, 0% 100%)"
    }, {
      clipPath: "polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)",
      duration: 0.6,
      ease: "power2.out"
    });
  }
  displayIndex() {
    this.elements.slideShowCounter.innerHTML = String(this.currentIndex + 1).padStart(2, '0');
  }
  swapMediaElement(mediaElem, mediaType) {
    const oldElem = this.elements.slideShowContainer.firstChild;
    const newElem = this.createNewMediaItem(mediaType);
    this.setMediaAttributes(newElem, mediaElem, mediaType);
    this.elements.slideShowContainer.appendChild(newElem);
    this.tl.fromTo(newElem, {
      opacity: 0
    }, {
      opacity: 1,
      duration: 0.4,
      ease: "power2.out"
    });
    this.tl.to(oldElem, {
      opacity: 0,
      duration: 0.4,
      ease: "power2.out",
      onComplete: () => {
        oldElem.remove();
      }
    }, "-=0.2");
  }
  setupScrollNavigation() {
    let ticking = false;
    window.addEventListener('wheel', e => {
      if (!this.allowSlideNavigation || ticking) return;
      ticking = true;
      const direction = e.deltaY > 0 ? 1 : -1;
      this.changeMedia(direction);
      setTimeout(() => {
        ticking = false;
      }, 600); // delay to prevent overscroll
    });
  }
  setupSwipeNavigation() {
    let touchStartX = 0;
    let touchEndX = 0;
    const threshold = 50; // Minimum swipe distance

    const container = this.elements.slideShowContainer;
    container.addEventListener('touchstart', e => {
      touchStartX = e.changedTouches[0].screenX;
    });
    container.addEventListener('touchend', e => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    });
    const handleSwipe = () => {
      if (!this.allowSlideNavigation) return;
      const delta = touchStartX - touchEndX;
      if (Math.abs(delta) > threshold) {
        const direction = delta > 0 ? 1 : -1;
        this.changeMedia(direction);
      }
    };
  }
  disableSlideNavigation() {
    this.allowSlideNavigation = false;
  }
  enableSlideNavigation() {
    this.allowSlideNavigation = true;
  }
  createNewMediaItem(type) {
    const elem = type === "video" ? document.createElement('video') : document.createElement('img');
    elem.classList.add('slideshow-media__item');
    return elem;
  }
  setMediaAttributes(elem, mediaElem, mediaType) {
    const mediaId = mediaElem.dataset.galleryId;
    elem.setAttribute('data-slideshow-id', mediaId);
    if (mediaType === "video") {
      elem.setAttribute('autoplay', '');
      elem.setAttribute('muted', '');
      elem.setAttribute('loop', '');
      elem.setAttribute('playsinline', '');
      const source = document.createElement('source');
      source.src = mediaElem.querySelector("source").src;
      source.type = "video/mp4";
      elem.appendChild(source);

      // âœ… Important: call play explicitly
      elem.addEventListener('loadeddata', () => {
        elem.play().catch(err => {
          console.warn('Autoplay prevented:', err);
        });
      });
    } else {
      elem.src = mediaElem.dataset.gallerySrc;
      elem.alt = mediaElem.alt || "Gallery Image";
    }
  }
  updateMinimapIndicator(mediaId = this.media[this.currentIndex]?.dataset.galleryId, instant = false) {
    if (!mediaId) return;
    let miniMapRect = this.elements.miniMap.getBoundingClientRect();
    this.elements.miniMapItems.forEach((item, i) => {
      if (item.dataset.galleryId === mediaId) {
        let itemRect = item.getBoundingClientRect();
        const targetX = -item.offsetLeft;
        const indicatorXpos = itemRect.left - miniMapRect.left;
        if (instant) {
          gsap__WEBPACK_IMPORTED_MODULE_2__["default"].set(this.elements.miniMapIndicator, {
            x: indicatorXpos
          });
          gsap__WEBPACK_IMPORTED_MODULE_2__["default"].set(this.elements.miniMap, {
            x: targetX
          });
        } else {
          gsap__WEBPACK_IMPORTED_MODULE_2__["default"].to(this.elements.miniMapIndicator, {
            x: indicatorXpos,
            duration: 0.4,
            ease: "zoom"
          });
          gsap__WEBPACK_IMPORTED_MODULE_2__["default"].to(this.elements.miniMap, {
            x: targetX,
            duration: 0.4,
            ease: "power3.out"
          });
        }
      }
    });
  }

  // Check URL on Page Load & Open Slideshow if Needed
  checkURLForSlideShow() {
    window.addEventListener("DOMContentLoaded", () => {
      const urlParams = new URLSearchParams(window.location.search);
      const mediaId = urlParams.get("media");
      if (mediaId) {
        const mediaElement = document.querySelector(`[data-gallery-id="${mediaId}"]`);
        if (mediaElement) this.openSlideShow({
          target: mediaElement
        });
      }
    });
  }
  animateImages(useStrollTrigger, show = true) {
    let clipPathPoly = show ? "polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%)" : "polygon(0% 100%, 100% 100%, 100% 100%, 0% 100%)";
    if (useStrollTrigger) {
      gsap__WEBPACK_IMPORTED_MODULE_2__["default"].to(this.elements.galleryItems, {
        clipPath: clipPathPoly,
        duration: 0.6,
        scrollTrigger: {
          trigger: this.elements.galleryItems,
          start: 'top bottom',
          scrub: false,
          markers: false
        },
        ease: "zoom"
      });
    } else {
      gsap__WEBPACK_IMPORTED_MODULE_2__["default"].to(this.elements.galleryItems, {
        clipPath: clipPathPoly,
        duration: 0.6,
        ease: "zoom"
      });
    }
  }
  animateAssets(tl, resolve) {
    super.animateAssets(tl, () => {
      this.animateImages(true);
      resolve();
    });
  }
  handleResize = () => {
    this.updateMinimapIndicator();
  };

  // Debounce helper (avoids spamming during resize)
  debounce(fn, delay = 100) {
    let timeout;
    return () => {
      clearTimeout(timeout);
      timeout = setTimeout(fn, delay);
    };
  }
  addEventListeners() {
    if (!this.elements.galleryItems || !this.elements.close) return;
    gsap__WEBPACK_IMPORTED_MODULE_2__["default"].set(this.elements.galleryItems, {
      clipPath: "polygon(0% 100%, 100% 100%, 100% 100%, 0% 100%)"
    });
    if (Array.isArray(this.elements.galleryItems) || typeof this.elements.galleryItems === 'object') {
      this.media = Array.from(this.elements.galleryItems);
      this.elements.galleryItems.forEach(element => {
        element.addEventListener('click', e => {
          this.openSlideShow(e);
        });
      });
    } else {
      this.elements.galleryItems.addEventListener('click', e => {
        this.openSlideShow(e);
      });
    }
    if (this.elements.prev) {
      this.elements.prev.addEventListener('click', () => {
        this.changeMedia(-1);
      });
    }
    if (this.elements.next) {
      this.elements.next.addEventListener('click', () => {
        this.changeMedia(1);
      });
    }
    this.elements.close.addEventListener('click', () => {
      this.closeSlideShow();
    });
    window.addEventListener('resize', this.debounce(this.handleResize));
  }
  init() {
    this.addEventListeners();
    this.checkURLForSlideShow();
    this.setupSwipeNavigation();
    this.setupScrollNavigation();
  }
}

/***/ })

},
/******/ function(__webpack_require__) { // webpackRuntimeModules
/******/ /* webpack/runtime/getFullHash */
/******/ (() => {
/******/ 	__webpack_require__.h = () => ("1ebae0a04c3e128f871c")
/******/ })();
/******/ 
/******/ }
);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi43NzY2NWY2ZGUxZDhhMTllMzNlYy5ob3QtdXBkYXRlLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQStCO0FBQ1I7QUFDbUI7QUFDRTtBQUU3QixNQUFNSSxPQUFPLFNBQVNKLG9EQUFJLENBQUM7RUFDeENLLFdBQVdBLENBQUEsRUFBRztJQUNaLEtBQUssQ0FBQztNQUNKQyxFQUFFLEVBQUUsU0FBUztNQUNiQyxRQUFRLEVBQUU7UUFDUkMsT0FBTyxFQUFFLGdCQUFnQjtRQUN6QkMsWUFBWSxFQUFFLHFCQUFxQjtRQUNuQ0MsU0FBUyxFQUFFLGtCQUFrQjtRQUM3QkMsSUFBSSxFQUFFLHVCQUF1QjtRQUM3QkMsSUFBSSxFQUFFLHVCQUF1QjtRQUM3QkMsS0FBSyxFQUFFLCtCQUErQjtRQUN0Q0Msa0JBQWtCLEVBQUUsNEJBQTRCO1FBQ2hEQyxnQkFBZ0IsRUFBRSx3QkFBd0I7UUFDMUNDLE9BQU8sRUFBRSxpQkFBaUI7UUFDMUJDLFlBQVksRUFBRSxzQkFBc0I7UUFDcENDLGdCQUFnQixFQUFFO01BQ3BCO0lBQ0YsQ0FBQyxDQUFDO0lBRUZqQiw0Q0FBSSxDQUFDa0IsY0FBYyxDQUFDaEIsdURBQVUsQ0FBQztJQUMvQkEsdURBQVUsQ0FBQ2lCLE1BQU0sQ0FBQyxNQUFNLEVBQUUsa0JBQWtCLENBQUM7SUFFN0MsSUFBSSxDQUFDQyxFQUFFLEdBQUdwQiw0Q0FBSSxDQUFDcUIsUUFBUSxDQUFDLENBQUM7SUFDekIsSUFBSSxDQUFDQyxZQUFZLEdBQUcsQ0FBQztJQUNyQixJQUFJLENBQUNDLEtBQUssR0FBRyxFQUFFO0lBQ2YsSUFBSSxDQUFDdEIsTUFBTSxHQUFHQSxxREFBTTtJQUNwQixJQUFJLENBQUN1QixlQUFlLEdBQUcsS0FBSztJQUU1QixJQUFJLENBQUNDLG9CQUFvQixHQUFHLEtBQUs7SUFFakMsSUFBSSxDQUFDQyxJQUFJLENBQUMsQ0FBQztFQUNiO0VBRUFDLGFBQWFBLENBQUNDLENBQUMsRUFBRTtJQUNmLE1BQU1DLFlB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QUNLLElBQUksQ0FBQzhFLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxNQUFNO1FBQ2pELElBQUksQ0FBQ3hCLFdBQVcsQ0FBQyxDQUFDLENBQUM7TUFDckIsQ0FBQyxDQUFDO0lBQ0o7SUFFQSxJQUFJLENBQUMzRCxRQUFRLENBQUNNLEtBQUssQ0FBQzZFLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxNQUFNO01BQ2xELElBQUksQ0FBQ3hDLGNBQWMsQ0FBQyxDQUFDO0lBQ3ZCLENBQUMsQ0FBQztJQUVGVSxNQUFNLENBQUM4QixnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDc0QsUUFBUSxDQUFDLElBQUksQ0FBQ0QsWUFBWSxDQUFDLENBQUM7RUFDckU7RUFFQXBILElBQUlBLENBQUEsRUFBRztJQUNMLElBQUksQ0FBQzBILGlCQUFpQixDQUFDLENBQUM7SUFDeEIsSUFBSSxDQUFDcEIsb0JBQW9CLENBQUMsQ0FBQztJQUMzQixJQUFJLENBQUNwQyxvQkFBb0IsQ0FBQyxDQUFDO0lBQzNCLElBQUksQ0FBQ0wscUJBQXFCLENBQUMsQ0FBQztFQUM5QjtBQUNGLEM7Ozs7Ozs7O1VDL1lBLHNEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcm9vbTE4Ny8uL2FwcC9wYWdlcy9HYWxsZXJ5L2luZGV4LmpzIiwid2VicGFjazovL3Jvb20xODcvd2VicGFjay9ydW50aW1lL2dldEZ1bGxIYXNoIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQYWdlIGZyb20gJ2NsYXNzZXMvUGFnZSdcbmltcG9ydCBnc2FwIGZyb20gJ2dzYXAnXG5pbXBvcnQgeyBzY3JvbGwgfSBmcm9tICd1dGlscy9MZW5pc1Njcm9sbCdcbmltcG9ydCB7IEN1c3RvbUVhc2UgfSBmcm9tICdnc2FwL0N1c3RvbUVhc2UnXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbGxlcnkgZXh0ZW5kcyBQYWdlIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoe1xuICAgICAgaWQ6ICdnYWxsZXJ5JyxcbiAgICAgIGVsZW1lbnRzOiB7XG4gICAgICAgIGdhbGxlcnk6ICdbZGF0YS1nYWxsZXJ5XScsXG4gICAgICAgIGdhbGxlcnlJdGVtczogJ1tkYXRhLWdhbGxlcnktaXRlbV0nLFxuICAgICAgICBzbGlkZVNob3c6ICdbZGF0YS1zbGlkZXNob3ddJyxcbiAgICAgICAgcHJldjogJ1tkYXRhLXNsaWRlc2hvdy1wcmV2XScsXG4gICAgICAgIG5leHQ6ICdbZGF0YS1zbGlkZXNob3ctbmV4dF0nLFxuICAgICAgICBjbG9zZTogJ1tkYXRhLXNsaWRlc2hvd10gW2RhdGEtY2xvc2VdJyxcbiAgICAgICAgc2xpZGVTaG93Q29udGFpbmVyOiAnW2RhdGEtc2xpZGVzaG93LWNvbnRhaW5lcl0nLFxuICAgICAgICBzbGlkZVNob3dDb3VudGVyOiAnW2RhdGEtc2xpZGVzaG93LWluZGV4XScsXG4gICAgICAgIG1pbmlNYXA6ICdbZGF0YS1taW5pLW1hcF0nLFxuICAgICAgICBtaW5pTWFwSXRlbXM6ICdbZGF0YS1taW5pLW1hcC1pdGVtXScsXG4gICAgICAgIG1pbmlNYXBJbmRpY2F0b3I6ICdbZGF0YS1taW5pLW1hcC1pbmRpY2F0b3JdJ1xuICAgICAgfVxuICAgIH0pXG5cbiAgICBnc2FwLnJlZ2lzdGVyUGx1Z2luKEN1c3RvbUVhc2UpXG4gICAgQ3VzdG9tRWFzZS5jcmVhdGUoXCJ6b29tXCIsIFwiMC43MSwgMCwgMC4wNiwgMVwiKVxuXG4gICAgdGhpcy50bCA9IGdzYXAudGltZWxpbmUoKVxuICAgIHRoaXMuY3VycmVudEluZGV4ID0gMFxuICAgIHRoaXMubWVkaWEgPSBbXVxuICAgIHRoaXMuc2Nyb2xsID0gc2Nyb2xsXG4gICAgdGhpcy5oYXNNZWRpYUJlZW5TZXQgPSBmYWxzZVxuXG4gICAgdGhpcy5hbGxvd1NsaWRlTmF2aWdhdGlvbiA9IGZhbHNlXG4gICAgXG4gICAgdGhpcy5pbml0KClcbiAgfVxuXG4gIG9wZW5TbGlkZVNob3coZSkge1xuICAgIGNvbnN0IG1lZGlhRWxlbWVudCA9IGUudGFyZ2V0O1xuICAgIGNvbnN0IG1lZGlhSWQgPSBtZWRpYUVsZW1lbnQuZGF0YXNldC5nYWxsZXJ5SWQ7XG5cbiAgICB0aGlzLmN1cnJlbnRJbmRleCA9IHRoaXMubWVkaWEuZmluZEluZGV4KG1lZGlhID0+IG1lZGlhLmRhdGFzZXQuZ2FsbGVyeUlkID09PSBtZWRpYUlkKVxuICAgIHRoaXMuZGlzcGxheUluZGV4KClcbiAgICB0aGlzLnNjcm9sbC5zdG9wKClcbiAgICB0aGlzLnRsLmNsZWFyKClcblxuICAgIHRoaXMudXBkYXRlTWluaW1hcEluZGljYXRvcihtZWRpYUlkLCB0cnVlKTtcblxuXG4gICAgdGhpcy50bC50byh0aGlzLmVsZW1lbnRzLmdhbGxlcnlJdGVtcywgeyBcbiAgICAgIGNsaXBQYXRoOiBcInBvbHlnb24oMCUgMTAwJSwgMTAwJSAxMDAlLCAxMDAlIDEwMCUsIDAlIDEwMCUpXCIsIFxuICAgICAgZHVyYXRpb246IDAuNCxcbiAgICAgIGVhc2U6IFwiem9vbVwiXG4gICAgfSlcblxuICAgIHRoaXMudGwudG8odGhpcy5lbGVtZW50cy5zbGlkZVNob3csIHtcbiAgICAgIGNsaXBQYXRoOiBcInBvbHlnb24oMCUgMCUsIDEwMCUgMCUsIDEwMCUgMTAwJSwgMCUgMTAwJSlcIixcbiAgICAgIGR1cmF0aW9uOiAwLjYsXG4gICAgICBlYXNlOiBcInpvb21cIixcbiAgICAgIG9uQ29tcGxldGU6ICgpID0+IHtcbiAgICAgICAgdGhpcy5lbGVtZW50cy5zbGlkZVNob3cuY2xhc3NMaXN0LnJlbW92ZSgnY2Fubm90LWludGVyYWN0JylcbiAgICAgICAgdGhpcy5zaG93TWVkaWEoKVxuICAgICAgICB0aGlzLmVuYWJsZVNsaWRlTmF2aWdhdGlvbigpXG4gICAgICB9XG4gICAgfSwgJy09MC4yJylcblxuICAgIHRoaXMudGwudG8odGhpcy5lbGVtZW50cy5jbG9zZSwgeyBvcGFjaXR5OiAxLCBkdXJhdGlvbjogMC4zLCBlYXNlOiBcInBvd2VyMi5vdXRcIiB9KVxuICAgIHRoaXMudGwudG8odGhpcy5lbGVtZW50cy5wcmV2LCB7IG9wYWNpdHk6IDEsIGR1cmF0aW9uOiAwLjMsIGVhc2U6IFwicG93ZXIyLm91dFwiIH0sICdjb250cm9scycpXG4gICAgdGhpcy50bC50byh0aGlzLmVsZW1lbnRzLm5leHQsIHsgb3BhY2l0eTogMSwgZHVyYXRpb246IDAuMywgZWFzZTogXCJwb3dlcjIub3V0XCIgfSwgJ2NvbnRyb2xzJylcbiAgfVxuXG4gIGNsb3NlU2xpZGVTaG93KCkge1xuICAgIHRoaXMuZGlzYWJsZVNsaWRlTmF2aWdhdGlvbigpXG4gICAgbGV0IHNsaWRlU2hvd01lZGlhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNsaWRlc2hvdy1tZWRpYV9faXRlbScpXG4gICAgdGhpcy5lbGVtZW50cy5zbGlkZVNob3cuY2xhc3NMaXN0LmFkZCgnY2Fubm90LWludGVyYWN0JylcblxuICAgIHRoaXMudGwudG8odGhpcy5lbGVtZW50cy5zbGlkZVNob3csIHtcbiAgICAgIGNsaXBQYXRoOiBcInBvbHlnb24oMCUgMTAwJSwgMTAwJSAxMDAlLCAxMDAlIDEwMCUsIDAlIDEwMCUpXCIsXG4gICAgICBkdXJhdGlvbjogMC42LFxuICAgICAgZWFzZTogXCJ6b29tXCIsXG4gICAgICBvbkNvbXBsZXRlOiAoKSA9PiB7XG4gICAgICAgIHNsaWRlU2hvd01lZGlhLnJlbW92ZSgpXG4gICAgICAgIHRoaXMuaGFzTWVkaWFCZWVuU2V0ID0gZmFsc2VcbiAgICAgICAgdGhpcy5zY3JvbGwuc3RhcnQoKVxuICAgICAgICB0aGlzLmFuaW1hdGVJbWFnZXMoZmFsc2UsIHRydWUpXG4gICAgICB9XG4gICAgfSlcblxuICAgIHRoaXMudGwudG8odGhpcy5lbGVtZW50cy5jbG9zZSwgeyBvcGFjaXR5OiAwLCBkdXJhdGlvbjogMC4wMDEgfSwgJ2hpZGUnKVxuICAgIHRoaXMudGwudG8odGhpcy5lbGVtZW50cy5wcmV2LCB7IG9wYWNpdHk6IDAsIGR1cmF0aW9uOiAwLjAwMSB9LCAnaGlkZScpXG4gICAgdGhpcy50bC50byh0aGlzLmVsZW1lbnRzLm5leHQsIHsgb3BhY2l0eTogMCwgZHVyYXRpb246IDAuMDAxIH0sICdoaWRlJylcbiAgICBcbiAgICAvLyBSZW1vdmUgaW1hZ2UgcGFyYW1ldGVyIGZyb20gVVJMXG4gICAgY29uc3QgbmV3VXJsID0gbmV3IFVSTCh3aW5kb3cubG9jYXRpb24pO1xuICAgIG5ld1VybC5zZWFyY2hQYXJhbXMuZGVsZXRlKFwibWVkaWFcIik7XG4gICAgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKHt9LCBcIlwiLCBuZXdVcmwpO1xuICB9XG4gIFxuICBjaGFuZ2VNZWRpYShkaXJlY3Rpb24pIHtcbiAgICBjb25zdCBvbGRJbmRleCA9IHRoaXMuY3VycmVudEluZGV4XG4gICAgdGhpcy5jdXJyZW50SW5kZXggPSAodGhpcy5jdXJyZW50SW5kZXggKyBkaXJlY3Rpb24gKyB0aGlzLm1lZGlhLmxlbmd0aCkgJSB0aGlzLm1lZGlhLmxlbmd0aFxuICAgIHRoaXMuZGlzcGxheUluZGV4KClcbiAgICBpZiAob2xkSW5kZXggPT09IHRoaXMuY3VycmVudEluZGV4KSByZXR1cm5cblxuICAgIGlmICh0aGlzLnRsLmlzQWN0aXZlKCkpIHtcbiAgICAgIHRoaXMudGwuYWRkKCgpID0+IHtcbiAgICAgICAgdGhpcy5zaG93TWVkaWEoKTtcbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2hvd01lZGlhKCk7XG4gICAgfVxuICB9XG5cbiAgc2hvd01lZGlhKCkge1xuICAgIGNvbnN0IG1lZGlhQ3VycmVudEVsZW0gPSB0aGlzLm1lZGlhW3RoaXMuY3VycmVudEluZGV4XVxuICAgIGNvbnN0IG1lZGlhVHlwZSA9IG1lZGlhQ3VycmVudEVsZW0uZGF0YXNldC5nYWxsZXJ5SXRlbVxuICAgIGNvbnN0IG1lZGlhSWQgPSBtZWRpYUN1cnJlbnRFbGVtLmRhdGFzZXQuZ2FsbGVyeUlkO1xuICAgIFxuICAgIHRoaXMudXBkYXRlTWluaW1hcEluZGljYXRvcihtZWRpYUlkKVxuXG4gICAgLy8gSWYgdGhlIHNhbWUgbWVkaWEsIGRvbid0IGRvIGFueXRoaW5nXG4gICAgaWYgKHRoaXMuZWxlbWVudHMuc2xpZGVTaG93Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXNsaWRlc2hvdy1pZD1cIiR7bWVkaWFJZH1cIl1gKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5oYXNNZWRpYUJlZW5TZXQpIHtcbiAgICAgIHRoaXMuY3JlYXRlQW5kU2V0TWVkaWFFbGVtZW50KG1lZGlhQ3VycmVudEVsZW0sIG1lZGlhVHlwZSlcbiAgICAgIHRoaXMuaGFzTWVkaWFCZWVuU2V0ID0gdHJ1ZVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnN3YXBNZWRpYUVsZW1lbnQobWVkaWFDdXJyZW50RWxlbSwgbWVkaWFUeXBlKVxuICAgIH1cblxuICAgIC8vIFVwZGF0ZSB0aGUgVVJMIHdpdGggdGhlIG5ldyBpbWFnZSBJRFxuICAgIGNvbnN0IG5ld1VybCA9IG5ldyBVUkwod2luZG93LmxvY2F0aW9uKVxuICAgIG5ld1VybC5zZWFyY2hQYXJhbXMuc2V0KFwibWVkaWFcIiwgbWVkaWFJZClcbiAgICB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUoe30sIFwiXCIsIG5ld1VybClcbiAgfVxuXG4gIGNyZWF0ZUFuZFNldE1lZGlhRWxlbWVudChtZWRpYUVsZW0sIG1lZGlhVHlwZSkge1xuICAgIGNvbnN0IG5ld0VsZW0gPSB0aGlzLmNyZWF0ZU5ld01lZGlhSXRlbShtZWRpYVR5cGUpXG4gICAgdGhpcy5zZXRNZWRpYUF0dHJpYnV0ZXMobmV3RWxlbSwgbWVkaWFFbGVtLCBtZWRpYVR5cGUpXG5cbiAgICB0aGlzLmVsZW1lbnRzLnNsaWRlU2hvd0NvbnRhaW5lci5pbm5lckhUTUwgPSAnJyAvLyBDbGVhciBwcmV2aW91cyBlbGVtZW50c1xuICAgIHRoaXMuZWxlbWVudHMuc2xpZGVTaG93Q29udGFpbmVyLmFwcGVuZENoaWxkKG5ld0VsZW0pXG5cblxuICAgIGdzYXAuZnJvbVRvKG5ld0VsZW0sIHsgY2xpcFBhdGg6IFwicG9seWdvbigwJSAxMDAlLCAxMDAlIDEwMCUsIDEwMCUgMTAwJSwgMCUgMTAwJSlcIiB9LCB7IGNsaXBQYXRoOiBcInBvbHlnb24oMCUgMCUsIDEwMCUgMCUsIDEwMCUgMTAwJSwgMCUgMTAwJSlcIiwgZHVyYXRpb246IDAuNiwgZWFzZTogXCJwb3dlcjIub3V0XCIgfSlcbiAgfVxuXG4gIGRpc3BsYXlJbmRleCgpIHtcbiAgICB0aGlzLmVsZW1lbnRzLnNsaWRlU2hvd0NvdW50ZXIuaW5uZXJIVE1MID0gU3RyaW5nKHRoaXMuY3VycmVudEluZGV4ICsgMSkucGFkU3RhcnQoMiwgJzAnKVxuICB9XG5cbiAgc3dhcE1lZGlhRWxlbWVudChtZWRpYUVsZW0sIG1lZGlhVHlwZSkge1xuICAgIGNvbnN0IG9sZEVsZW0gPSB0aGlzLmVsZW1lbnRzLnNsaWRlU2hvd0NvbnRhaW5lci5maXJzdENoaWxkXG4gICAgY29uc3QgbmV3RWxlbSA9IHRoaXMuY3JlYXRlTmV3TWVkaWFJdGVtKG1lZGlhVHlwZSlcbiAgICB0aGlzLnNldE1lZGlhQXR0cmlidXRlcyhuZXdFbGVtLCBtZWRpYUVsZW0sIG1lZGlhVHlwZSlcblxuICAgIHRoaXMuZWxlbWVudHMuc2xpZGVTaG93Q29udGFpbmVyLmFwcGVuZENoaWxkKG5ld0VsZW0pXG4gICAgXG4gICAgdGhpcy50bC5mcm9tVG8obmV3RWxlbSwgeyBvcGFjaXR5OiAwIH0sIHsgb3BhY2l0eTogMSwgZHVyYXRpb246IDAuNCwgZWFzZTogXCJwb3dlcjIub3V0XCIgfSlcbiAgICBcbiAgICB0aGlzLnRsLnRvKG9sZEVsZW0sIHtcbiAgICAgIG9wYWNpdHk6IDAsXG4gICAgICBkdXJhdGlvbjogMC40LFxuICAgICAgZWFzZTogXCJwb3dlcjIub3V0XCIsXG4gICAgICBvbkNvbXBsZXRlOiAoKSA9PiB7XG4gICAgICAgIG9sZEVsZW0ucmVtb3ZlKClcbiAgICAgIH1cbiAgICB9LCBcIi09MC4yXCIpXG4gIH1cblxuICBzZXR1cFNjcm9sbE5hdmlnYXRpb24oKSB7XG4gICAgbGV0IHRpY2tpbmcgPSBmYWxzZTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIChlKSA9PiB7XG4gICAgICBpZiAoIXRoaXMuYWxsb3dTbGlkZU5hdmlnYXRpb24gfHwgdGlja2luZykgcmV0dXJuO1xuXG4gICAgICB0aWNraW5nID0gdHJ1ZTtcbiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IGUuZGVsdGFZID4gMCA/IDEgOiAtMTtcblxuICAgICAgdGhpcy5jaGFuZ2VNZWRpYShkaXJlY3Rpb24pO1xuXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGlja2luZyA9IGZhbHNlO1xuICAgICAgfSwgNjAwKTsgLy8gZGVsYXkgdG8gcHJldmVudCBvdmVyc2Nyb2xsXG4gICAgfSk7XG4gIH1cblxuICBzZXR1cFN3aXBlTmF2aWdhdGlvbigpIHtcbiAgICBsZXQgdG91Y2hTdGFydFggPSAwO1xuICAgIGxldCB0b3VjaEVuZFggPSAwO1xuXG4gICAgY29uc3QgdGhyZXNob2xkID0gNTA7IC8vIE1pbmltdW0gc3dpcGUgZGlzdGFuY2VcblxuICAgIGNvbnN0IGNvbnRhaW5lciA9IHRoaXMuZWxlbWVudHMuc2xpZGVTaG93Q29udGFpbmVyO1xuXG4gICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCAoZSkgPT4ge1xuICAgICAgdG91Y2hTdGFydFggPSBlLmNoYW5nZWRUb3VjaGVzWzBdLnNjcmVlblg7XG4gICAgfSk7XG5cbiAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCAoZSkgPT4ge1xuICAgICAgdG91Y2hFbmRYID0gZS5jaGFuZ2VkVG91Y2hlc1swXS5zY3JlZW5YO1xuICAgICAgaGFuZGxlU3dpcGUoKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IGhhbmRsZVN3aXBlID0gKCkgPT4ge1xuICAgICAgaWYgKCF0aGlzLmFsbG93U2xpZGVOYXZpZ2F0aW9uKSByZXR1cm47XG4gICAgICBjb25zdCBkZWx0YSA9IHRvdWNoU3RhcnRYIC0gdG91Y2hFbmRYO1xuICAgICAgXG4gICAgICBpZiAoTWF0aC5hYnMoZGVsdGEpID4gdGhyZXNob2xkKSB7XG4gICAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IGRlbHRhID4gMCA/IDEgOiAtMTtcbiAgICAgICAgdGhpcy5jaGFuZ2VNZWRpYShkaXJlY3Rpb24pO1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBkaXNhYmxlU2xpZGVOYXZpZ2F0aW9uKCkge1xuICAgIHRoaXMuYWxsb3dTbGlkZU5hdmlnYXRpb24gPSBmYWxzZTtcbiAgfVxuXG4gIGVuYWJsZVNsaWRlTmF2aWdhdGlvbigpIHtcbiAgICB0aGlzLmFsbG93U2xpZGVOYXZpZ2F0aW9uID0gdHJ1ZTtcbiAgfVxuXG4gIGNyZWF0ZU5ld01lZGlhSXRlbSh0eXBlKSB7XG4gICAgY29uc3QgZWxlbSA9IHR5cGUgPT09IFwidmlkZW9cIiA/IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ZpZGVvJykgOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKVxuICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgnc2xpZGVzaG93LW1lZGlhX19pdGVtJylcbiAgICByZXR1cm4gZWxlbVxuICB9XG5cbiAgc2V0TWVkaWFBdHRyaWJ1dGVzKGVsZW0sIG1lZGlhRWxlbSwgbWVkaWFUeXBlKSB7XG4gICAgY29uc3QgbWVkaWFJZCA9IG1lZGlhRWxlbS5kYXRhc2V0LmdhbGxlcnlJZFxuXG4gICAgZWxlbS5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2xpZGVzaG93LWlkJywgbWVkaWFJZClcblxuICAgIGlmIChtZWRpYVR5cGUgPT09IFwidmlkZW9cIikge1xuICAgICAgZWxlbS5zZXRBdHRyaWJ1dGUoJ2F1dG9wbGF5JywgJycpXG4gICAgICBlbGVtLnNldEF0dHJpYnV0ZSgnbXV0ZWQnLCAnJylcbiAgICAgIGVsZW0uc2V0QXR0cmlidXRlKCdsb29wJywgJycpXG4gICAgICBlbGVtLnNldEF0dHJpYnV0ZSgncGxheXNpbmxpbmUnLCAnJylcblxuICAgICAgY29uc3Qgc291cmNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJylcbiAgICAgIHNvdXJjZS5zcmMgPSBtZWRpYUVsZW0ucXVlcnlTZWxlY3RvcihcInNvdXJjZVwiKS5zcmNcbiAgICAgIHNvdXJjZS50eXBlID0gXCJ2aWRlby9tcDRcIlxuICAgICAgZWxlbS5hcHBlbmRDaGlsZChzb3VyY2UpXG5cbiAgICAgIC8vIOKchSBJbXBvcnRhbnQ6IGNhbGwgcGxheSBleHBsaWNpdGx5XG4gICAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlZGRhdGEnLCAoKSA9PiB7XG4gICAgICAgIGVsZW0ucGxheSgpLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ0F1dG9wbGF5IHByZXZlbnRlZDonLCBlcnIpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBlbGVtLnNyYyA9IG1lZGlhRWxlbS5kYXRhc2V0LmdhbGxlcnlTcmNcbiAgICAgIGVsZW0uYWx0ID0gbWVkaWFFbGVtLmFsdCB8fCBcIkdhbGxlcnkgSW1hZ2VcIlxuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZU1pbmltYXBJbmRpY2F0b3IobWVkaWFJZCA9IHRoaXMubWVkaWFbdGhpcy5jdXJyZW50SW5kZXhdPy5kYXRhc2V0LmdhbGxlcnlJZCwgaW5zdGFudCA9IGZhbHNlKSB7XG4gICAgaWYgKCFtZWRpYUlkKSByZXR1cm5cbiAgICBsZXQgbWluaU1hcFJlY3QgPSB0aGlzLmVsZW1lbnRzLm1pbmlNYXAuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcblxuICAgIHRoaXMuZWxlbWVudHMubWluaU1hcEl0ZW1zLmZvckVhY2goKGl0ZW0sIGkpID0+IHtcbiAgICAgIGlmIChpdGVtLmRhdGFzZXQuZ2FsbGVyeUlkID09PSBtZWRpYUlkKSB7XG4gICAgICAgIGxldCBpdGVtUmVjdCA9IGl0ZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHRhcmdldFggPSAtaXRlbS5vZmZzZXRMZWZ0XG4gICAgICAgIGNvbnN0IGluZGljYXRvclhwb3MgPSBpdGVtUmVjdC5sZWZ0IC0gbWluaU1hcFJlY3QubGVmdFxuXG4gICAgICAgIGlmIChpbnN0YW50KSB7XG4gICAgICAgICAgZ3NhcC5zZXQodGhpcy5lbGVtZW50cy5taW5pTWFwSW5kaWNhdG9yLCB7eDogaW5kaWNhdG9yWHBvc30pXG4gICAgICAgICAgZ3NhcC5zZXQodGhpcy5lbGVtZW50cy5taW5pTWFwLCB7IHg6IHRhcmdldFggfSlcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGdzYXAudG8odGhpcy5lbGVtZW50cy5taW5pTWFwSW5kaWNhdG9yLCB7XG4gICAgICAgICAgICB4OiBpbmRpY2F0b3JYcG9zLFxuICAgICAgICAgICAgZHVyYXRpb246IDAuNCxcbiAgICAgICAgICAgIGVhc2U6IFwiem9vbVwiXG4gICAgICAgICAgfSlcblxuICAgICAgICAgIGdzYXAudG8odGhpcy5lbGVtZW50cy5taW5pTWFwLCB7XG4gICAgICAgICAgICB4OiB0YXJnZXRYLFxuICAgICAgICAgICAgZHVyYXRpb246IDAuNCxcbiAgICAgICAgICAgIGVhc2U6IFwicG93ZXIzLm91dFwiXG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLy8gQ2hlY2sgVVJMIG9uIFBhZ2UgTG9hZCAmIE9wZW4gU2xpZGVzaG93IGlmIE5lZWRlZFxuICBjaGVja1VSTEZvclNsaWRlU2hvdygpIHtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTtcbiAgICAgIGNvbnN0IG1lZGlhSWQgPSB1cmxQYXJhbXMuZ2V0KFwibWVkaWFcIik7XG4gIFxuICAgICAgaWYgKG1lZGlhSWQpIHtcbiAgICAgICAgY29uc3QgbWVkaWFFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtZ2FsbGVyeS1pZD1cIiR7bWVkaWFJZH1cIl1gKTtcbiAgICAgICAgaWYgKG1lZGlhRWxlbWVudCkgdGhpcy5vcGVuU2xpZGVTaG93KHsgdGFyZ2V0OiBtZWRpYUVsZW1lbnQgfSk7XG4gICAgICB9XG4gICAgfSlcbiAgfVxuICBcbiAgYW5pbWF0ZUltYWdlcyh1c2VTdHJvbGxUcmlnZ2VyLCBzaG93ID0gdHJ1ZSkge1xuICAgIGxldCBjbGlwUGF0aFBvbHkgPSBzaG93PyBcInBvbHlnb24oMCUgMCUsIDEwMCUgMCUsIDEwMCUgMTAwJSwgMCUgMTAwJSlcIiA6IFwicG9seWdvbigwJSAxMDAlLCAxMDAlIDEwMCUsIDEwMCUgMTAwJSwgMCUgMTAwJSlcIiBcblxuICAgIGlmKHVzZVN0cm9sbFRyaWdnZXIpIHtcbiAgICAgIGdzYXAudG8odGhpcy5lbGVtZW50cy5nYWxsZXJ5SXRlbXMsXG4gICAgICAgIHtcbiAgICAgICAgICBjbGlwUGF0aDogY2xpcFBhdGhQb2x5LFxuICAgICAgICAgIGR1cmF0aW9uOiAwLjYsXG4gICAgICAgICAgc2Nyb2xsVHJpZ2dlcjoge1xuICAgICAgICAgICAgdHJpZ2dlcjogdGhpcy5lbGVtZW50cy5nYWxsZXJ5SXRlbXMsXG4gICAgICAgICAgICBzdGFydDogJ3RvcCBib3R0b20nLFxuICAgICAgICAgICAgc2NydWI6IGZhbHNlLFxuICAgICAgICAgICAgbWFya2VyczogZmFsc2VcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVhc2U6IFwiem9vbVwiXG4gICAgICAgIH1cbiAgICAgIClcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBnc2FwLnRvKHRoaXMuZWxlbWVudHMuZ2FsbGVyeUl0ZW1zLFxuICAgICAgICB7XG4gICAgICAgICAgY2xpcFBhdGg6IGNsaXBQYXRoUG9seSxcbiAgICAgICAgICBkdXJhdGlvbjogMC42LFxuICAgICAgICAgIGVhc2U6IFwiem9vbVwiXG4gICAgICAgIH1cbiAgICAgIClcbiAgICB9XG4gIH1cblxuICBhbmltYXRlQXNzZXRzKHRsLCByZXNvbHZlKSB7XG4gICAgc3VwZXIuYW5pbWF0ZUFzc2V0cyh0bCwgKCkgPT4ge1xuICAgICAgdGhpcy5hbmltYXRlSW1hZ2VzKHRydWUpXG5cbiAgICAgIHJlc29sdmUoKVxuICAgIH0pXG4gIH1cblxuICBoYW5kbGVSZXNpemUgPSAoKSA9PiB7XG4gICAgdGhpcy51cGRhdGVNaW5pbWFwSW5kaWNhdG9yKClcbiAgfVxuXG4gIC8vIERlYm91bmNlIGhlbHBlciAoYXZvaWRzIHNwYW1taW5nIGR1cmluZyByZXNpemUpXG4gIGRlYm91bmNlKGZuLCBkZWxheSA9IDEwMCkge1xuICAgIGxldCB0aW1lb3V0XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KVxuICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQoZm4sIGRlbGF5KVxuICAgIH1cbiAgfVxuXG4gIGFkZEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIGlmKCF0aGlzLmVsZW1lbnRzLmdhbGxlcnlJdGVtcyB8fCAhdGhpcy5lbGVtZW50cy5jbG9zZSkgcmV0dXJuXG5cbiAgICBnc2FwLnNldCh0aGlzLmVsZW1lbnRzLmdhbGxlcnlJdGVtcywgeyBjbGlwUGF0aDogXCJwb2x5Z29uKDAlIDEwMCUsIDEwMCUgMTAwJSwgMTAwJSAxMDAlLCAwJSAxMDAlKVwifSlcbiAgICBcbiAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLmVsZW1lbnRzLmdhbGxlcnlJdGVtcykgfHwgKHR5cGVvZiB0aGlzLmVsZW1lbnRzLmdhbGxlcnlJdGVtcyA9PT0gJ29iamVjdCcpKSB7XG4gICAgICB0aGlzLm1lZGlhID0gQXJyYXkuZnJvbSh0aGlzLmVsZW1lbnRzLmdhbGxlcnlJdGVtcylcbiAgICAgIHRoaXMuZWxlbWVudHMuZ2FsbGVyeUl0ZW1zLmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgIHRoaXMub3BlblNsaWRlU2hvdyhlKVxuICAgICAgICB9KVxuICAgICAgfSk7XG4gICAgICBcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5lbGVtZW50cy5nYWxsZXJ5SXRlbXMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICB0aGlzLm9wZW5TbGlkZVNob3coZSlcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgaWYodGhpcy5lbGVtZW50cy5wcmV2KSB7XG4gICAgICB0aGlzLmVsZW1lbnRzLnByZXYuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuY2hhbmdlTWVkaWEoLTEpXG4gICAgICB9KVxuICAgIH1cblxuICAgIGlmKHRoaXMuZWxlbWVudHMubmV4dCkge1xuICAgICAgdGhpcy5lbGVtZW50cy5uZXh0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICB0aGlzLmNoYW5nZU1lZGlhKDEpXG4gICAgICB9KVxuICAgIH1cblxuICAgIHRoaXMuZWxlbWVudHMuY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICB0aGlzLmNsb3NlU2xpZGVTaG93KClcbiAgICB9KVxuXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMuZGVib3VuY2UodGhpcy5oYW5kbGVSZXNpemUpKVxuICB9XG5cbiAgaW5pdCgpIHtcbiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXJzKClcbiAgICB0aGlzLmNoZWNrVVJMRm9yU2xpZGVTaG93KClcbiAgICB0aGlzLnNldHVwU3dpcGVOYXZpZ2F0aW9uKClcbiAgICB0aGlzLnNldHVwU2Nyb2xsTmF2aWdhdGlvbigpXG4gIH1cbn0iLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmggPSAoKSA9PiAoXCIxZWJhZTBhMDRjM2UxMjhmODcxY1wiKSJdLCJuYW1lcyI6WyJQYWdlIiwiZ3NhcCIsInNjcm9sbCIsIkN1c3RvbUVhc2UiLCJHYWxsZXJ5IiwiY29uc3RydWN0b3IiLCJpZCIsImVsZW1lbnRzIiwiZ2FsbGVyeSIsImdhbGxlcnlJdGVtcyIsInNsaWRlU2hvdyIsInByZXYiLCJuZXh0IiwiY2xvc2UiLCJzbGlkZVNob3dDb250YWluZXIiLCJzbGlkZVNob3dDb3VudGVyIiwibWluaU1hcCIsIm1pbmlNYXBJdGVtcyIsIm1pbmlNYXBJbmRpY2F0b3IiLCJyZWdpc3RlclBsdWdpbiIsImNyZWF0ZSIsInRsIiwidGltZWxpbmUiLCJjdXJyZW50SW5kZXgiLCJtZWRpYSIsImhhc01lZGlhQmVlblNldCIsImFsbG93U2xpZGVOYXZpZ2F0aW9uIiwiaW5pdCIsIm9wZW5TbGlkZVNob3ciLCJlIiwibWVkaWFFbGVtZW50IiwidGFyZ2V0IiwibWVkaWFJZCIsImRhdGFzZXQiLCJnYWxsZXJ5SWQiLCJmaW5kSW5kZXgiLCJkaXNwbGF5SW5kZXgiLCJzdG9wIiwiY2xlYXIiLCJ1cGRhdGVNaW5pbWFwSW5kaWNhdG9yIiwidG8iLCJjbGlwUGF0aCIsImR1cmF0aW9uIiwiZWFzZSIsIm9uQ29tcGxldGUiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJzaG93TWVkaWEiLCJlbmFibGVTbGlkZU5hdmlnYXRpb24iLCJvcGFjaXR5IiwiY2xvc2VTbGlkZVNob3ciLCJkaXNhYmxlU2xpZGVOYXZpZ2F0aW9uIiwic2xpZGVTaG93TWVkaWEiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJhZGQiLCJzdGFydCIsImFuaW1hdGVJbWFnZXMiLCJuZXdVcmwiLCJVUkwiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNlYXJjaFBhcmFtcyIsImRlbGV0ZSIsImhpc3RvcnkiLCJwdXNoU3RhdGUiLCJjaGFuZ2VNZWRpYSIsImRpcmVjdGlvbiIsIm9sZEluZGV4IiwibGVuZ3RoIiwiaXNBY3RpdmUiLCJtZWRpYUN1cnJlbnRFbGVtIiwibWVkaWFUeXBlIiwiZ2FsbGVyeUl0ZW0iLCJjcmVhdGVBbmRTZXRNZWRpYUVsZW1lbnQiLCJzd2FwTWVkaWFFbGVtZW50Iiwic2V0IiwibWVkaWFFbGVtIiwibmV3RWxlbSIsImNyZWF0ZU5ld01lZGlhSXRlbSIsInNldE1lZGlhQXR0cmlidXRlcyIsImlubmVySFRNTCIsImFwcGVuZENoaWxkIiwiZnJvbVRvIiwiU3RyaW5nIiwicGFkU3RhcnQiLCJvbGRFbGVtIiwiZmlyc3RDaGlsZCIsInNldHVwU2Nyb2xsTmF2aWdhdGlvbiIsInRpY2tpbmciLCJhZGRFdmVudExpc3RlbmVyIiwiZGVsdGFZIiwic2V0VGltZW91dCIsInNldHVwU3dpcGVOYXZpZ2F0aW9uIiwidG91Y2hTdGFydFgiLCJ0b3VjaEVuZFgiLCJ0aHJlc2hvbGQiLCJjb250YWluZXIiLCJjaGFuZ2VkVG91Y2hlcyIsInNjcmVlblgiLCJoYW5kbGVTd2lwZSIsImRlbHRhIiwiTWF0aCIsImFicyIsInR5cGUiLCJlbGVtIiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsInNvdXJjZSIsInNyYyIsInBsYXkiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJ3YXJuIiwiZ2FsbGVyeVNyYyIsImFsdCIsImluc3RhbnQiLCJtaW5pTWFwUmVjdCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsImZvckVhY2giLCJpdGVtIiwiaSIsIml0ZW1SZWN0IiwidGFyZ2V0WCIsIm9mZnNldExlZnQiLCJpbmRpY2F0b3JYcG9zIiwibGVmdCIsIngiLCJjaGVja1VSTEZvclNsaWRlU2hvdyIsInVybFBhcmFtcyIsIlVSTFNlYXJjaFBhcmFtcyIsInNlYXJjaCIsImdldCIsInVzZVN0cm9sbFRyaWdnZXIiLCJzaG93IiwiY2xpcFBhdGhQb2x5Iiwic2Nyb2xsVHJpZ2dlciIsInRyaWdnZXIiLCJzY3J1YiIsIm1hcmtlcnMiLCJhbmltYXRlQXNzZXRzIiwicmVzb2x2ZSIsImhhbmRsZVJlc2l6ZSIsImRlYm91bmNlIiwiZm4iLCJkZWxheSIsInRpbWVvdXQiLCJjbGVhclRpbWVvdXQiLCJhZGRFdmVudExpc3RlbmVycyIsIkFycmF5IiwiaXNBcnJheSIsImZyb20iLCJlbGVtZW50Il0sInNvdXJjZVJvb3QiOiIifQ==